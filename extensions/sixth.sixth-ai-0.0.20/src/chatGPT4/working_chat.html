<!DOCTYPE html>
<html>

<head>
    <title>Chatbot</title>
    <link rel="icon" href="bot.png" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">


   <!-- Prism.js Core CSS -->
   <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
   <!-- Prism.js Core JS -->
   <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


<style>
    :root {
        /* Core colors from theme */
        --editor-background: #1E1E1E;
        --editor-foreground: #D4D4D4;
        --button-background: #007ACC;
        --button-foreground: #FFFFFF;
        --input-background: #3C3C3C;
        --input-foreground: #9399B2; 
        --panel-background: #252526;
        
        /* Token colors */
        --token-string: #CE9178;
        --token-variable: #9CDCFE;
        --token-class: #4EC9B0;
        --token-keyword: #569CD6;
    }

    body {
        background: var(--editor-background);
        color: var(--editor-foreground);
    }

    .container {
        background-color: var(--editor-background);
    }

    .chat {
        background-color: var(--editor-background);
    }

    /* Buttons */
    .floating-action-button {
        background: var(--button-background);
        color: var(--button-foreground);
    }

    /* Input areas */
    textarea {
        background-color: var(--editor-background);
        color: var(--input-foreground);
    }

    .textarea-container {
        background-color: var(--editor-background);
    }

    /* Code blocks */
    .code-block {
        background-color: var(--editor-background);
        color: var(--editor-foreground);
    }

    .code-toolbarr {
        background: var(--editor-background);
        color: var(--editor-foreground);
    }

    /* Syntax highlighting */
    .token.string {
        color: var(--token-string);
    }

    .token.variable {
        color: var(--token-variable);
    }

    .token.class-name {
        color: var(--token-class);
    }

    .token.keyword {
        color: var(--token-keyword);
    }

    /* User interface elements */
    .user_avatar {
        background-color: var(--button-background);
    }

    .user_avatar_text {
        color: var(--button-foreground);
    }

    /* Messages */
    .user_response span {
        color: var(--editor-foreground) !important;
    }

    .bot code {
        color: var(--editor-foreground) !important;
        background-color: transparent;
    }

    /* SVG elements */
    svg[fill="#FDE4FF"] {
        fill: var(--editor-foreground) !important;
    }

    .previous-chat-span,
    #attachement_first_name,
   

    /* PrismJS theme overrides */
    code[class*="language-"],
    pre[class*="language-"] {
        color: var(--token-string);
        background: var(--editor-background);
    }

    .token.comment {
        color: var(--token-variable);
        opacity: 0.6;
    }

    .token.punctuation {
        color: var(--editor-foreground);
    }

    .token.property,
    .token.tag,
    .token.constant,
    .token.symbol,
    .token.deleted {
        color: var(--token-keyword);
    }

    .token.boolean,
    .token.number {
        color: var(--token-string);
    }

    .token.selector,
    .token.attr-name,
    .token.string,
    .token.char,
    .token.builtin,
    .token.inserted {
        color: var(--token-string);
    }

    .token.operator,
    .token.entity,
    .token.url,
    .language-css .token.string,
    .style .token.string {
        color: var(--token-variable);
    }

    .token.atrule,
    .token.attr-value,
    .token.keyword {
        color: var(--token-keyword);
    }

    .token.function,
    .token.class-name {
        color: var(--token-class);
    }

    .container {
        background-color: var(--editor-background);
    }

    .chat {
        background-color: var(--editor-background);
    }

    /* Buttons */
    .floating-action-button {
        background: var(--button-background);
        color: var(--button-foreground);
    }

    .floating-action-button:hover {
        background: var(--button-hover-background);
    }

    /* Input areas */
    textarea {
        background-color: var(--editor-background);
        color: var(--input-foreground);
        border: 1px solid var(--input-border);
    }

    .textarea-container {
        border: 1px solid var(--input-border);
        background-color: var(--editor-background);
        height: auto;
    }

    .textarea-container textarea {
        background-color:var(--editor-background);
        color: var(--input-foreground);
    }

    /* Dropdown */
    #mention-dropdown {
        background-color: var(--dropdown-background);
        border: 1px solid var(--dropdown-border);
    }

    /* Other elements */
    .pop-up-modal {
        background-color: var(--editor-background);
        border: 1px solid var(--input-border);
        box-shadow: 0 2px 8px var(--widget-shadow);
    }

    .pop-up-modal-upgrade-btn {
        background-color: var(--button-background);
        color: var(--button-foreground);
    }

    .pop-up-modal-upgrade-btn:hover {
        background-color: var(--button-hover-background);
    }

    a {
        color: var(--text-link-foreground);
    }

    a:hover {
        color: var(--text-link-active-foreground);
    }

    /* Error/warning messages */
    .error-message {
        color: var(--error-foreground);
    }

    .warning-message {
        color: var(--warning-foreground);
    }

    /* ... update other color properties similarly ... */

    /* Code block styling in bot responses */
    .bot .code-block {
        position: relative;
        background-color: var(--editor-background);
        border: 0.75px solid rgba(255, 255, 255, 0.1);
        border-radius: 4px;
        margin: 8px 0;
        overflow: hidden;
        max-height: 700px; 
        transition: max-height 0.3s ease-out;
    }

    .bot .code-block pre {
        margin: 0;
        padding: 16px;
        padding-bottom: 40px; /* Add padding at bottom to prevent overlap with expand button */
    }

    .bot .code-block .code-actions {
        position: absolute;
        top: 8px;
        right: 8px;
        display: none;
        gap: 4px;
        padding: 4px;
        border-radius: 4px;
        background-color: var(--editor-background);
        border: 0.75px solid rgba(255, 255, 255, 0.1);
        z-index: 1000;
    }

    .bot .code-block:hover .code-actions {
        display: flex;
    }

    .bot .code-block .code-action-btn {
        background-color: var(--editor-background);
        border: none;
        color: var(--input-foreground);
        padding: 4px 8px;
        cursor: pointer;
        border-radius: 4px;
        opacity: 0.7;
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .bot .code-block .code-action-btn:hover {
        opacity: 1;
    }

    .bot .code-action-btn-text {
        font-size: 10px;
        font-weight: 600;
        color: var(--input-foreground);
    }

    /* Add styles for the expand button */
    .code-block .expand-button {
        display: none; /* Hidden by default */
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        padding: 8px;
        text-align: center;
        background: linear-gradient(transparent, var(--editor-background) 50%);
        cursor: pointer;
        opacity: 0.8;
        transition: opacity 0.2s;
    }

    .code-block .expand-button:hover {
        opacity: 1;
    }

    .code-block .expand-button i {
        color: var(--editor-foreground);
        transform: rotate(0deg);
        transition: transform 0.3s;
    }

    .code-block.expanded .expand-button i {
        transform: rotate(180deg);
    }

    .code-block.expanded {
        max-height: none;
    }

    /* Show expand button only when content overflows */
    .code-block.overflow .expand-button {
        display: block;
    }

    /* Add these styles for the status bar */
    .status-bar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background-color: var(--editor-background);
        padding: 0 8px;
        height: 35px;
        border-bottom: none; /* Remove bottom border */
    }

    .status-bar-left {
        display: flex;
        align-items: center;
        flex: 1; /* Take up remaining space */
    }

    .status-bar-right {
        display: flex;
        align-items: center;
        gap: 12px; /* Increased gap between icons */
    }

    /* Update tab and action button styles */
    .tab {
        display: flex;
        align-items: center;
        padding: 0 12px;
        height: 100%;
        color: var(--editor-foreground);
        font-size: 10px;
        cursor: pointer;
        border: none;
        background: none;
        opacity: 0.5;
        transition: all 0.2s;
        font-weight: 600;
        padding-bottom: 8px;
    }

    .tab.active {
        opacity: 1;
        font-weight: 800;
        border-bottom: 1px solid var(--editor-foreground); /* Match text color */
        margin-bottom: -1px;
        padding-bottom: 8px;
    }

    .status-bar-icon {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 28px;
        height: 28px;
        cursor: pointer;
        opacity: 0.5;
        transition: opacity 0.2s;
        color: var(--input-foreground);
        background: none; /* Remove background */
    }

    .status-bar-icon:hover {
        opacity: 1;
    }

    .status-bar-icon i {
        font-size: 14px;
        color: var(--input-foreground);
    }

    /* Add styles for the connection error message */
    .connection-error {
        display: none;
        padding: 8px 12px;
        background-color: rgba(255, 0, 0, 0.1);
        border-bottom: 1px solid var(--input-foreground);
        font-size: 11px;
        color: var(--editor-foreground);
        gap: 8px;
        align-items: center;
    }

    .connection-error button {
        background: transparent;
        border: none;
        color: var(--editor-foreground);
        font-size: 11px;
        cursor: pointer;
        padding: 2px 8px;
        opacity: 0.8;
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .connection-error button:hover {
        opacity: 1;
    }
</style>

<style id="prism-theme" class="prism-theme">
    /* PrismJS 1.29.0
https://prismjs.com/download.html#themes=prism-okaidia&languages=markup+css+clike+javascript+abap+abnf+actionscript+ada+agda+al+antlr4+apacheconf+apex+apl+applescript+aql+arduino+arff+armasm+arturo+asciidoc+aspnet+asm6502+asmatmel+autohotkey+autoit+avisynth+avro-idl+awk+bash+basic+batch+bbcode+bbj+bicep+birb+bison+bnf+bqn+brainfuck+brightscript+bro+bsl+c+csharp+cpp+cfscript+chaiscript+cil+cilkc+cilkcpp+clojure+cmake+cobol+coffeescript+concurnas+csp+cooklang+coq+crystal+css-extras+csv+cue+cypher+d+dart+dataweave+dax+dhall+diff+django+dns-zone-file+docker+dot+ebnf+editorconfig+eiffel+ejs+elixir+elm+etlua+erb+erlang+excel-formula+fsharp+factor+false+firestore-security-rules+flow+fortran+ftl+gml+gap+gcode+gdscript+gedcom+gettext+gherkin+git+glsl+gn+linker-script+go+go-module+gradle+graphql+groovy+haml+handlebars+haskell+haxe+hcl+hlsl+hoon+http+hpkp+hsts+ichigojam+icon+icu-message-format+idris+ignore+inform7+ini+io+j+java+javadoc+javadoclike+javastacktrace+jexl+jolie+jq+jsdoc+js-extras+json+json5+jsonp+jsstacktrace+js-templates+julia+keepalived+keyman+kotlin+kumir+kusto+latex+latte+less+lilypond+liquid+lisp+livescript+llvm+log+lolcode+lua+magma+makefile+markdown+markup-templating+mata+matlab+maxscript+mel+mermaid+metafont+mizar+mongodb+monkey+moonscript+n1ql+n4js+nand2tetris-hdl+naniscript+nasm+neon+nevod+nginx+nim+nix+nsis+objectivec+ocaml+odin+opencl+openqasm+oz+parigp+parser+pascal+pascaligo+psl+pcaxis+peoplecode+perl+php+phpdoc+php-extras+plant-uml+plsql+powerquery+powershell+processing+prolog+promql+properties+protobuf+pug+puppet+pure+purebasic+purescript+python+qsharp+q+qml+qore+r+racket+cshtml+jsx+tsx+reason+regex+rego+renpy+rescript+rest+rip+roboconf+robotframework+ruby+rust+sas+sass+scss+scala+scheme+shell-session+smali+smalltalk+smarty+sml+solidity+solution-file+soy+sparql+splunk-spl+sqf+sql+squirrel+stan+stata+iecst+stylus+supercollider+swift+systemd+t4-templating+t4-cs+t4-vb+tap+tcl+tt2+textile+toml+tremor+turtle+twig+typescript+typoscript+unrealscript+uorazor+uri+v+vala+vbnet+velocity+verilog+vhdl+vim+visual-basic+warpscript+wasm+web-idl+wgsl+wiki+wolfram+wren+xeora+xml-doc+xojo+xquery+yaml+yang+zig&plugins=line-highlight+show-language+highlight-keywords+inline-color+toolbar+copy-to-clipboard+match-braces+diff-highlight+treeview */
/**
* okaidia theme for JavaScript, CSS and HTML
* Loosely based on Monokai textmate theme by http://www.monokai.nl/
* @author ocodia
*/

code[class*="language-"],
pre[class*="language-"] {
color: var(--editor-foreground);
background: none;
text-shadow: none;
font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
font-size: 1em;
text-align: left;
white-space: pre;
word-spacing: normal;
word-break: normal;
word-wrap: normal;
line-height: 1.5;

-moz-tab-size: 4;
-o-tab-size: 4;
tab-size: 4;

-webkit-hyphens: none;
-moz-hyphens: none;
-ms-hyphens: none;
hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
padding: 1em;
margin: .5em 0;
overflow: scroll;
border-radius: 0.3rem;
max-width: 500px;
background: var(--editor-background);
border: 1px solid var(--input-border);
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
background: var(--editor-background);
}

/* Inline code */
:not(pre) > code[class*="language-"] {
    padding: .1em .3em;
    border-radius: .3em;
    background: var(--editor-background);
    border: 1px solid var(--input-border);
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
    color: var(--token-string, '#6A9955');
}

.token.punctuation {
    color: var(--token-keyword);
}

.token.namespace {
    color: var(--token-keyword);
    opacity: 0.7;
}

.token.property,
.token.tag,
.token.constant,
.token.symbol,
.token.deleted {
    color: var(--syntax-number, '#B5CEA8');
}

.token.boolean,
.token.number {
    color: var(--token-variable);
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
    color: var(--token-string, '#CE9178');
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string,
.token.variable {
    color: var(--token-variable);
}

.token.atrule,
.token.attr-value,
.token.function,
.token.class-name {
    color: var(--token-class);
}

.token.keyword {
    color: var(--token-keyword);
}

.token.regex,
.token.important {
    color: var(--token-keyword);
}

.token.important,
.token.bold {
font-weight: bold;
}

.token.italic {
font-style: italic;
}

.token.entity {
cursor: help;
}

pre[data-line] {
position: relative;
padding: 1em 0 1em 3em;
}

.line-highlight {
    background: var(--token-keyword);
    border: 1px solid var(--token-keyword);
    position: absolute;
    left: 0;
    right: 0;
    padding: inherit 0;
    margin-top: 1em;
    pointer-events: none;
    line-height: inherit;
    white-space: pre;
}

@media print {
.line-highlight {
    /*
     * This will prevent browsers from replacing the background color with white.
     * It's necessary because the element is layered on top of the displayed code.
     */
    -webkit-print-color-adjust: exact;
    color-adjust: exact;
}
}

.line-numbers .line-numbers-rows {
    border-right: 1px solid var(--token-string);
}

.line-numbers-rows > span:before {
    color: var(--token-string);
}


.line-highlight:before,
.line-highlight[data-end]:after {
    content: attr(data-start);
    position: absolute;
    top: .4em;
    left: .6em;
    min-width: 1em;
    padding: 0 .5em;
    background-color: hsla(24, 20%, 50%,.4);
    color: hsl(24, 20%, 95%);
    font: bold 65%/1.5 sans-serif;
    text-align: center;
    vertical-align: .3em;
    border-radius: 999px;
    text-shadow: none;
    box-shadow: 0 1px white;
}

.line-highlight[data-end]:after {
    content: attr(data-end);
    top: auto;
    bottom: .4em;
}

.line-numbers .line-highlight:before,
.line-numbers .line-highlight:after {
content: none;
}

pre[id].linkable-line-numbers span.line-numbers-rows {
pointer-events: all;
}
pre[id].linkable-line-numbers span.line-numbers-rows > span:before {
cursor: pointer;
}
pre[id].linkable-line-numbers span.line-numbers-rows > span:hover:before {
background-color: rgba(128, 128, 128, .2);
}

div.code-toolbar {
position: relative;
}

div.code-toolbar > .toolbar {
position: absolute;
z-index: 10;
top: .3em;
right: .2em;
transition: opacity 0.3s ease-in-out;
opacity: 0;
}

div.code-toolbar:hover > .toolbar {
opacity: 1;
}

/* Separate line b/c rules are thrown out if selector is invalid.
IE11 and old Edge versions don't support :focus-within. */
div.code-toolbar:focus-within > .toolbar {
opacity: 1;
}

div.code-toolbar > .toolbar > .toolbar-item {
display: inline-block;
}

div.code-toolbar > .toolbar > .toolbar-item > a {
cursor: pointer;
}

div.code-toolbar > .toolbar > .toolbar-item > button {
background: none;
border: 0;
color: inherit;
font: inherit;
line-height: normal;
overflow: visible;
padding: 0;
-webkit-user-select: none; /* for button */
-moz-user-select: none;
-ms-user-select: none;
}

div.code-toolbar > .toolbar > .toolbar-item > a,
div.code-toolbar > .toolbar > .toolbar-item > button,
div.code-toolbar > .toolbar > .toolbar-item > span {
color: var(--editor-foreground);
opacity: 0.7;
font-size: .8em;
padding: 0 .5em;
background: var(--editor-background);
opacity: 0.2;
box-shadow: 0 2px 0 0 rgba(0,0,0,0.2);
border-radius: .5em;
}

div.code-toolbar > .toolbar > .toolbar-item > a:hover,
div.code-toolbar > .toolbar > .toolbar-item > a:focus,
div.code-toolbar > .toolbar > .toolbar-item > button:hover,
div.code-toolbar > .toolbar > .toolbar-item > button:focus,
div.code-toolbar > .toolbar > .toolbar-item > span:hover,
div.code-toolbar > .toolbar > .toolbar-item > span:focus {
color: var(--editor-foreground);
text-decoration: none;
}

span.inline-color-wrapper {
/*
 * The background image is the following SVG inline in base 64:
 *
 * <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2 2">
 *     <path fill="gray" d="M0 0h2v2H0z"/>
 *     <path fill="white" d="M0 0h1v1H0zM1 1h1v1H1z"/>
 * </svg>
 *
 * SVG-inlining explained:
 * https://stackoverflow.com/a/21626701/7595472
 */
background: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyIDIiPjxwYXRoIGZpbGw9ImdyYXkiIGQ9Ik0wIDBoMnYySDB6Ii8+PHBhdGggZmlsbD0id2hpdGUiIGQ9Ik0wIDBoMXYxSDB6TTEgMWgxdjFIMXoiLz48L3N2Zz4=");
/* This is to prevent visual glitches where one pixel from the repeating pattern could be seen. */
background-position: center;
background-size: 110%;

display: inline-block;
height: 1.333ch;
width: 1.333ch;
margin: 0 .333ch;
box-sizing: border-box;
border: 1px solid white;
outline: 1px solid rgba(0,0,0,.5);
overflow: hidden;
}

span.inline-color {
display: block;
/* To prevent visual glitches again */
height: 120%;
width: 120%;
}

.token.punctuation.brace-hover,
.token.punctuation.brace-selected {
    background: var(--token-keyword);
    border: 1px solid var(--token-keyword);
    outline: none;
}

.rainbow-braces .token.punctuation.brace-level-1,
.rainbow-braces .token.punctuation.brace-level-5,
.rainbow-braces .token.punctuation.brace-level-9 {
    color: var(--token-keyword);
   
}
.rainbow-braces .token.punctuation.brace-level-2,
.rainbow-braces .token.punctuation.brace-level-6,
.rainbow-braces .token.punctuation.brace-level-10 {
    color: var(--token-keyword);
    opacity: 0.8;
}
.rainbow-braces .token.punctuation.brace-level-3,
.rainbow-braces .token.punctuation.brace-level-7,
.rainbow-braces .token.punctuation.brace-level-11 {
    color: var(--token-keyword);
   
}
.rainbow-braces .token.punctuation.brace-level-4,
.rainbow-braces .token.punctuation.brace-level-8,
.rainbow-braces .token.punctuation.brace-level-12 {
    color: var(--token-keyword);
   
}

pre.diff-highlight > code .token.deleted:not(.prefix),
pre > code.diff-highlight .token.deleted:not(.prefix) {
background-color: var(--token-keyword);
opacity: 0.1;
color: inherit;
display: block;
}

pre.diff-highlight > code .token.inserted:not(.prefix),
pre > code.diff-highlight .token.inserted:not(.prefix) {
background-color: var(--token-keyword);
opacity: 0.1;
color: inherit;
display: block;
}

.token.treeview-part .entry-line {
position: relative;
text-indent: -99em;
display: inline-block;
vertical-align: top;
width: 1.2em;
}
.token.treeview-part .entry-line:before,
.token.treeview-part .line-h:after {
content: "";
position: absolute;
top: 0;
left: 50%;
width: 50%;
height: 100%;
}
.token.treeview-part .line-h:before,
.token.treeview-part .line-v:before {
border-left: 1px solid #ccc;
}
.token.treeview-part .line-v-last:before {
height: 50%;
border-left: 1px solid #ccc;
border-bottom: 1px solid #ccc;
}
.token.treeview-part .line-h:after {
height: 50%;
border-bottom: 1px solid #ccc;
}
.token.treeview-part .entry-name {
position: relative;
display: inline-block;
vertical-align: top;
}
.token.treeview-part .entry-name.dotfile {
opacity: 0.5;
}

/* @GENERATED-FONT */
@font-face {
font-family: "PrismTreeview";
/**
 * This font is generated from the .svg files in the `icons` folder. See the `treeviewIconFont` function in
 * `gulpfile.js/index.js` for more information.
 *
 * Use the following escape sequences to refer to a specific icon:
 *
 * - \ea01 file
 * - \ea02 folder
 * - \ea03 image
 * - \ea04 audio
 * - \ea05 video
 * - \ea06 text
 * - \ea07 code
 * - \ea08 archive
 * - \ea09 pdf
 * - \ea0a excel
 * - \ea0b powerpoint
 * - \ea0c word
 */
src: url("data:application/font-woff;base64,d09GRgABAAAAAAgYAAsAAAAAEGAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAADsAAABUIIslek9TLzIAAAFEAAAAPwAAAFY1UkH9Y21hcAAAAYQAAAB/AAACCtvO7yxnbHlmAAACBAAAA+MAAAlACm1VqmhlYWQAAAXoAAAAKgAAADZfxj5jaGhlYQAABhQAAAAYAAAAJAFbAMFobXR4AAAGLAAAAA4AAAA0CGQAAGxvY2EAAAY8AAAAHAAAABwM9A9CbWF4cAAABlgAAAAfAAAAIAEgAHZuYW1lAAAGeAAAATcAAAJSfUrk+HBvc3QAAAewAAAAZgAAAIka0DSfeJxjYGRgYOBiMGCwY2BycfMJYeDLSSzJY5BiYGGAAJA8MpsxJzM9kYEDxgPKsYBpDiBmg4gCACY7BUgAeJxjYGRYyjiBgZWBgaGQoRZISkLpUAYOBj0GBiYGVmYGrCAgzTWFweEV4ysehs1ArgDDFgZGIA3CDAB2tQjAAHic7ZHLEcMwCESfLCz/VEoKSEE5parURxMOC4c0Ec283WGFdABgBXrwCAzam4bOK9KWeefM3Hhmjyn3ed+hTRq1pS7Ra/HjYGPniHcXMy4G/zNTP7/KW5HTXArkvdBW3ArN19dCG/NRIN8K5HuB/CiQn4U26VeBfBbML9NEH78AeJyVVc1u20YQ3pn905JcSgr/YsuSDTEg3cR1bFEkYyS1HQcQ2jQF2hot6vYSoECKnnPLA/SWUy9NTr31Bfp+6azsNI0SGiolzu7ODnfn+2Z2lnHG3rxhr9nfLGKbLGesncAYYnUHpsVnMG/uwyzNdFIVd6HI6twp8+R3LpT4TSglLoTHwwJgG2/dFvKrl9yI507/p5CCq4LTxB/PlPjkFaMHnWB/0S9je7RTPS+utnGtom1T2q5pk/e3H0M1S18rsXAL7wgpxQuhAmteGGvNjmcfGXuwnFNOPCXxeOGmnjrBLWNyBeNtVq2Hs03yus1aPS3mzSyNVSfu588iW1Q93x/4fjcHn+5EkS2tMxr4xIRa8ese+4L9uKZnxEqs8+ldyN9atU02a5t5uQ8hZGms1QTKpaKYqnipiNNOAIeIADC0JNEOYY+jtSgFoOchiAjRGFACpUTRje8bwIYWGCDEgENY8MEu9bnCYCdAxftoNg0KiSpUtPaHcanYwzXRu6T4r40b5npal3V7UHWCPJW9niyl1vIHgoujEXZjudBkeWkOeMQBRmbEPhKzij1i52t6/TadL+3q7H0U1eq4E8cG4gIIwQLx8VX7ToPXgPrehVc5QXHR7gMSmwjKfaYAP4KvZV+yn9bE18y2IY37LvtyrSg3i7ZK++B603ndlg/gBJpZRsfpBI6hyiaQ6FjlnThz8lAC3LgBIMnXDOAXxBQ4SIgiEhx2AcGCAwAhwjXRpCQms42bwAUt75BvAwgONzdgOfWEwzk4Ylzj4mz+5YEzzXzWX9aNlk7ot65y5QnBHsNlm6zDTu7sspRqG4V+fgJ1lVBZ07Nm7s5nemo3Lf3PO7iwtnroQ5/YDGwPRUip6fV6L+27p+wCHwSvPs85UnHqId8NAn5IBsKdv95KrL9m31Gsf2a/rluDslk1y1J9GE+LUmmVT/OyOHaFKGnapt2H5XeJTmKd6qYNoVVZOy+pWzr7rMip3ndG/4mQSoUcMbAqG/YNIAdXhkAqTVruXhocSKN0iS4Rwj7vSS4fcF/La07BfeQSuRAcFeW+9igjwPhhYPpGCBCBHhxiKMyFMFT7ziRH7RtfIWdiha+TdW+Rqs7bLHdN2ZJIKl0um0x3op9saYr0REeRdj09pl43pMzz4tjztrY8L4o8bzT+oLY27PR/eFtXs/YY5vtwB5Iqad14eYN0ujveMaGWqkdU3TKbQSC5Uvxaf4fA7SAQ3r2tEfIhd4duld91bwMisjqBw22orthNcroXl7KqO1329HBgAexgoCfGAwiDPoBnriki3lmNojrzvD0tjo6E3vPYP6E2BMIAeJxjYGRgYADiY8t3FsTz23xl4GbYzIAB/v9nWM6wBcjgYGAC8QH+QQhZAAB4nGNgZGBg2MzAACeXMzAyoAJeADPyAh14nGNgAILNpGEA0fgIZQAAAAAAAAA2AHIAvgE+AZgCCAKMAv4DlgPsBEYEoHicY2BkYGDgZchi4GQAASYg5gJCBob/YD4DABTSAZcAeJx9kU1uwjAQhV/4qwpqhdSqi67cTTeVEmBXDgBbhBD7AHYISuLUMSD2PUdP0HNwjp6i676k3qQS9Ujjb968mYUNoI8zPJTHw02Vy9PAFatfbpLuHbfIT47b6MF33KH+6riLF0wc93CHN27wWtdUHvHuuIFbfDhuUv903CKfHbfxgC/HHerfjrtYen3HPTx7ambiIl0YKQ+xPM5ltE9CU9NqxVKaItaZGPqDmj6VmTShlRuxOoniEI2sVUIZnYqJzqxMEi1yo3dybf2ttfk4CJTT/bVOMYNBjAIpFiTJOLCWOGLOHGGPBCE7l32XO0tmw04MjQwCQ7774B//lDmrZkJY3hvOrHBiLuiJMKJqoVgrejQ3CP5Yubt0JwxNJa96Oypr6j621VSOMQKG+uP36eKmHylcb0MAeJxtwdEOgjAMBdBeWEFR/Mdl7bTJtMsygc/nwVfPoYF+QP+tGDAigDFhxgVXLLjhjhUPCtmKTtmLaGN7x6dy/Io5bybqoevRQ3LRObb0sk3HKpn1SFqW6ru26vbpYfcmRCccJhqsAAA=")
    format("woff");
}

.token.treeview-part .entry-name:before {
content: "\ea01";
font-family: "PrismTreeview";
font-size: inherit;
font-style: normal;
-webkit-font-smoothing: antialiased;
-moz-osx-font-smoothing: grayscale;
width: 2.5ex;
display: inline-block;
}

.token.treeview-part .entry-name.dir:before {
content: "\ea02";
}
.token.treeview-part .entry-name.ext-bmp:before,
.token.treeview-part .entry-name.ext-eps:before,
.token.treeview-part .entry-name.ext-gif:before,
.token.treeview-part .entry-name.ext-jpe:before,
.token.treeview-part .entry-name.ext-jpg:before,
.token.treeview-part .entry-name.ext-jpeg:before,
.token.treeview-part .entry-name.ext-png:before,
.token.treeview-part .entry-name.ext-svg:before,
.token.treeview-part .entry-name.ext-tiff:before {
content: "\ea03";
}
.token.treeview-part .entry-name.ext-cfg:before,
.token.treeview-part .entry-name.ext-conf:before,
.token.treeview-part .entry-name.ext-config:before,
.token.treeview-part .entry-name.ext-csv:before,
.token.treeview-part .entry-name.ext-ini:before,
.token.treeview-part .entry-name.ext-log:before,
.token.treeview-part .entry-name.ext-md:before,
.token.treeview-part .entry-name.ext-nfo:before,
.token.treeview-part .entry-name.ext-txt:before {
content: "\ea06";
}
.token.treeview-part .entry-name.ext-asp:before,
.token.treeview-part .entry-name.ext-aspx:before,
.token.treeview-part .entry-name.ext-c:before,
.token.treeview-part .entry-name.ext-cc:before,
.token.treeview-part .entry-name.ext-cpp:before,
.token.treeview-part .entry-name.ext-cs:before,
.token.treeview-part .entry-name.ext-css:before,
.token.treeview-part .entry-name.ext-h:before,
.token.treeview-part .entry-name.ext-hh:before,
.token.treeview-part .entry-name.ext-htm:before,
.token.treeview-part .entry-name.ext-html:before,
.token.treeview-part .entry-name.ext-jav:before,
.token.treeview-part .entry-name.ext-java:before,
.token.treeview-part .entry-name.ext-js:before,
.token.treeview-part .entry-name.ext-php:before,
.token.treeview-part .entry-name.ext-rb:before,
.token.treeview-part .entry-name.ext-xml:before {
content: "\ea07";
}
.token.treeview-part .entry-name.ext-7z:before,
.token.treeview-part .entry-name.ext-bz:before,
.token.treeview-part .entry-name.ext-bz2:before,
.token.treeview-part .entry-name.ext-gz:before,
.token.treeview-part .entry-name.ext-rar:before,
.token.treeview-part .entry-name.ext-tar:before,
.token.treeview-part .entry-name.ext-tgz:before,
.token.treeview-part .entry-name.ext-zip:before {
content: "\ea08";
}
.token.treeview-part .entry-name.ext-aac:before,
.token.treeview-part .entry-name.ext-au:before,
.token.treeview-part .entry-name.ext-cda:before,
.token.treeview-part .entry-name.ext-flac:before,
.token.treeview-part .entry-name.ext-mp3:before,
.token.treeview-part .entry-name.ext-oga:before,
.token.treeview-part .entry-name.ext-ogg:before,
.token.treeview-part .entry-name.ext-wav:before,
.token.treeview-part .entry-name.ext-wma:before {
content: "\ea04";
}
.token.treeview-part .entry-name.ext-avi:before,
.token.treeview-part .entry-name.ext-flv:before,
.token.treeview-part .entry-name.ext-mkv:before,
.token.treeview-part .entry-name.ext-mov:before,
.token.treeview-part .entry-name.ext-mp4:before,
.token.treeview-part .entry-name.ext-mpeg:before,
.token.treeview-part .entry-name.ext-mpg:before,
.token.treeview-part .entry-name.ext-ogv:before,
.token.treeview-part .entry-name.ext-webm:before {
content: "\ea05";
}
.token.treeview-part .entry-name.ext-pdf:before {
content: "\ea09";
}
.token.treeview-part .entry-name.ext-xls:before,
.token.treeview-part .entry-name.ext-xlsx:before {
content: "\ea0a";
}
.token.treeview-part .entry-name.ext-doc:before,
.token.treeview-part .entry-name.ext-docm:before,
.token.treeview-part .entry-name.ext-docx:before {
content: "\ea0c";
}
.token.treeview-part .entry-name.ext-pps:before,
.token.treeview-part .entry-name.ext-ppt:before,
.token.treeview-part .entry-name.ext-pptx:before {
content: "\ea0b";
}


.token{
    padding: 1px;
    font-size: 11px;
    white-space: pre-wrap; /* Maintain white spaces */
    word-wrap: break-word; /* Break long words */
    max-width: 600px; /* Approx. 100 characters per line */

}

/* Update user chat text color */
.user_response span {
    color: var(--editor-foreground) !important; /* Light text color */
}

/* Update "Typing..." text color */
.bot code {
    color: var(--editor-foreground) !important; /* Light text color */
    background-color: transparent;
}

/* Update SVG colors */
svg[fill="#FDE4FF"] {
    fill: var(--editor-foreground) !important;
}



/* Update previous chat span text color */
.previous-chat-span {
    color: var(--editor-foreground) !important;
}

/* Update attachment text color */
#attachement_first_name {
    color: var(--editor-foreground) !important;
}

/* Add styles for the generating text */
.generating-text {
    position: relative; /* Changed from absolute */
    left: 0; /* Remove left margin */
    margin-top: 16px; /* Increase top margin */
    margin-bottom: 8px;
    font-size: 11px;
    font-weight: 500;
    color: var(--input-foreground);
    opacity: 0.8;
    align-self: flex-start;
    display: flex;
    align-items: center;
    padding-left: 12px; /* Add left padding instead of margin */
}

@keyframes dots {
    0% { content: '.'; }
    33% { content: '..'; }
    66% { content: '...'; }
    100% { content: '.'; }
}

.generating-text::after {
    content: '.';
    animation: dots 2s infinite;
    margin-left: 2px; /* Add small space between text and dots */
}

/* Update bot response container */
.bot.response {
    display: flex;
    flex-direction: column;
    gap: 4px; /* Add gap between generating text and content */
    width: 100%;
    padding: 0 12px; /* Add padding to align with other content */
}

</style>

<style>
    * {
        box-sizing: border-box;
    }

    html {
        height: 100%;
    }

    body {
        font-family: 'Poppins';
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        background: var(--editor-background);
        height: 100%;

    }

    span {
        padding-right: 15px;
        padding-left: 15px;
    }


    .container {
        display: flex;
        flex-direction: column;
        justify-content: center;
        width: 100%;
        height: 100%;
        background-color: var(--editor-background);
    }

    .chat {
        height: 93%;
        width: 100%;
        display: flex;
        flex-direction: column;
        justify-content: start;
        align-items: center;
        background-color: var(--editor-background);
        position: absolute;
        top: 5%;
        left: 0;
        right: 0;
        bottom: 0;
    }

    ::-webkit-input-placeholder {
        color: .711
    }

    textarea {
        position: relative;
        border: 0px none var(--border-color);
        width: 100%;
        background-color: var(--editor-background);
        color: var(--input-foreground);
        padding: 15px;
        font-family: 'Poppins';
    }

    textarea:focus {
        border: 0px none #ffffff;
        outline: none;
        padding: 15px;
    }

    .messages {
        display: flex;
        flex-direction: column;
        overflow: scroll;
        scrollbar-width: none; /* Firefox */
        -ms-overflow-style: none;  /* Internet Explorer 10+ */
        height: 90%;
        width: 100%;
        padding: 0px;
    }

    .click-cursor {
        cursor: pointer;
        opacity: 0.5;
    }
    .user_response{

    }
    .user_avatar{
        height: 26px;
        width: 26px;
        background-color: var(--button-background);
        border-radius: 13px;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    .user_avatar_text{
        font-size:12px;
        color: var(--editor-foreground);
    }

    /* Scaled down versions by 0.75 */
    .user_avatar {
        height: 19.5px;
        width: 19.5px;
        background-color: var(--button-background);
        border-radius: 9.75px;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    .user_avatar_text {
        font-size: 9px;
        color: var(--editor-foreground);
    }

    .bot {
        font-family: 'Poppins';
        width: 100%;
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
        background-color: transparent;
        /*background-color: #150816;*/
    }

    .avatar {
        height: 25px;
        margin-left: 10px;
    }

    .response {
        display: flex;
        align-items: center;
        /*background-color: #150816;*/
        background-color: transparent;
        font-size: 12px;
    }

    .skeleton-loading {
        animation: pulse 0.5s infinite alternate;
        background-color: #2CBFCA;
        border-radius: 10px;
        outline: none;
        color: #5D97EE;
    }

    @keyframes pulse {
        0% {
            opacity: 0.6;
        }

        100% {
            opacity: 1;
        }
    }

    .textarea-container {
        position: relative;
        width: max-content;
        border: 0;
        width: 100%;
        padding-right: 1.5rem;
        background-color: transparent;
        color: var(--input-foreground);
        border: 1px solid var(--border-color);
        bottom: 0;
        min-height: 100px;
        height: auto;
    }

    .textarea-container textarea {
        background-color: var(--editor-background);
        font-size: 12px;
        padding-top: 6px;
        padding-left: 6px;
        padding-bottom: 2.5rem;
        overflow-y: hidden; /* Hide scroll initially */
        resize: none; /* Prevent manual resizing */
        color: var(--input-foreground);
        height: auto;
        min-height: 100px;
        
    }

    .textarea-container textarea::placeholder {
        color: #9399B2; /* Lighter gray for placeholder */
        opacity: 0.74;
    }



    .floating-action-button {
        
        top: 0;
        right: 0;
        width: 30px;
        height: 30px;
        background: var(--button-background);
        border-radius: 50%;
        text-align: center;
        line-height: 60px;
        color: var(--input-foreground);
        font-size: 24px;
        cursor: pointer;
        box-shadow: 0px 3px 6px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        align-content: center;
    }


    .floating-action-button:hover::after {
        opacity: 1.0;
        height: fit-content;
        width: 180px;
        line-height: 16px;
    }


    .plus-icon {
        display: inline-block;
        vertical-align: middle;
    }

    .jira-button {
        text-align: center;
        color: rgb(199, 241, 241);
        font-weight: 600;
        padding-top: 15px;
        width: 100%;

    }

    .jira-span {
        background-color: transparent;
        padding: 10px;
        border-radius: 10px;
        border: 1px solid rgba(137, 180, 250, 0.6); /* Catppuccin blue with opacity */
        color: #CDD6F4;
        cursor: pointer;
        font-size: 10px;
    }

    
    .previous-chat-span{
        margin-top: 18px;
        color: #FDE4FF;
        cursor: pointer;
        font-size: 11px;
        font-weight: 600;
        display: flex;
        align-items: center;
        background-color: transparent;
    }

    .jira-span:hover {

        background-color: transparent;
        border: 2px solid #89B4FA;

    }

    .jira-span-question {

        display: flex;
        width: 100%;
        align-items: center;
        padding-right: 4rem;

    }

    .jira-span-question p {
        text-wrap: nowrap;
        color: white;
        font-size: 14px;
        font-weight: 400;
        line-height: 21px;
        text-align: center;

    }



    .jira-span::after {
        content: attr(title);
        position: absolute;
        left: 50%;
        margin-top: 40px;
        transform: translateX(-50%);
        background-color: #313244; /* Match modal background */
        color: #CDD6F4; /* Match text color */
        padding: 5px 10px;
        border-radius: 5px;
        opacity: 0;
        transition: opacity 0.3s;
        font-size: 10px;
        height: fit-content;
        width: 180px;
        line-height: 16px;
        text-align: left;
    }

    .jira-span:hover::after {
        opacity: 1;
        height: fit-content;
        width: 180px;
        line-height: 16px;
    }

    .usecase-button {
        width: 100%;
        height: 45px;
        text-align: center;
        color: #ececec;
        font-weight: 600;
        padding-top: 5px;
        border-radius: 10px;
        border: 1px solid rgba(137, 180, 250, 0.6);
        background-color: #1E1E2E;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        font-family: 'Poppins';
    }

    @keyframes glowing {
        0% {
            box-shadow: 0 0 0 0 rgb(252, 3, 86, 0.7);
        }

        50% {
            box-shadow: 0 0 50px 15px rgba(0, 118, 244, 0);
        }

        100% {
            box-shadow: 0 0 0 0 rgba(0, 123, 255, 0);
        }
    }


    @keyframes fadeInAnimation {
        from {
            opacity: 0;
            /* Start with transparency */
        }

        to {
            opacity: 1;
            /* Fully opaque */
        }
    }



    .usecase-span {
        text-align: start;
        color: #CDD6F4;
    }

    .usecase-button {
        margin-right: 16px; 
        border: 1px solid rgba(137, 180, 250, 0.6);
        display: flex;
        justify-content: start;
        flex-direction: row;
        align-items: center;
        font-family: 'Poppins';
        padding-bottom: 5px;
        background-color: #1E1E2E;
        
    }
    .usecase-button:hover {
        color: #ececec;
        background-color: #1E1E2E;
        border: 1px solid #ececec;
        opacity: 50%;
    }

    .cancel-button {
        color: #c5efee;
        margin-top: 10px;
        font-size: 14px;
        font-weight: 400;
        background-color: #2d2d2d;
        border-radius: 5px;
        border: 1px solid rgb(68, 131, 145);
        cursor: pointer;
        padding-left: 16px;
        padding-right: 16px;
        padding-top: 4px;
        padding-bottom: 4px;
    }

    .cancel-button::after {
        content: attr(title);
        position: absolute;
        left: 4%;
        margin-top: 40px;
        transform: translateX(-50%);
        background-color: #2d2d2d;
        color: rgb(199, 241, 241);
        padding: 5px 10px;
        border-radius: 5px;
        opacity: 0;
        transition: opacity 0.3s;
        font-size: 10px;
        height: fit-content;
        width: fit-content;
        line-height: 16px;
        text-align: left;
    }

    .cancel-button:hover::after {
        opacity: 1;
        height: fit-content;
        width: fit-content;
        line-height: 16px;
    }

    .gen-button {
        color: #FDE4FF;
        margin-top: 10px;
        font-size: 14px;
        font-weight: 400;
        background-color: #150816;
        border: 1px solid rgba(84, 84, 197, .6);
        border-radius: 5px;
        cursor: pointer;
        padding-left: 16px;
        padding-right: 16px;
        padding-top: 4px;
        padding-bottom: 4px;
    }

    .gen-button:hover {
        color: rgba(217, 217, 241, 0.6);
        border: 1px solid rgba(179, 179, 248, 0.6);

    }


    .line-number-input {
        color: #FDE4FF;
        margin-top: 10px;
        font-size: 14px;
        font-weight: 400;
        background-color: #150816;
        border: 1px solid rgba(84, 84, 197, .6);
        border-radius: 5px;
        cursor: pointer;
        padding-left: 16px;
        padding-right: 16px;
        padding-top: 4px;
        padding-bottom: 4px;
    }
    .line-number-input::placeholder{
        color: #8B8BB2;
        opacity: 0.74;
    }

    /* Keyframes for auto-scrolling */
    @keyframes scroll {
        0% {
            transform: translateX(0);
        }

        100% {
            transform: translateX(-50%);
        }
    }





    .addCodemodal {
        display: none;
        position: fixed;
        z-index: 1000;
        background-color: #150816;
        border: 1px solid rgba(84, 84, 197, .6);
        border-radius: 5px;
        padding: 20px;
        color: #FDE4FF;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-family: "Poppins";
    }

    .modal-content {
        text-align: center;
    }

    .close {
        color: #FDE4FF;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
    }

    .close:hover,
    .close:focus {
        color: rgb(219, 247, 247);
        text-decoration: none;
        cursor: pointer;
    }

    .overlay {
        display: none;
        position: fixed;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        top: 0;
        left: 0;
        z-index: 999;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }

    @keyframes fadeOut {
        from {
            opacity: 1;
        }
        to {
            opacity: 0;
        }
    }

    .fade-in {
        animation: fadeIn 0.5s ease-in forwards; /* Adjust the duration and easing function as needed */
    }

    .fade-out {
        animation: fadeOut 0.5s ease-out forwards; /* Adjust the duration and easing function as needed */
    }

    #questions_limit {
        
    }

    #questions_limit_reached {}

    #questions_limit_reached p {

        color: rgba(239, 169, 169, 1);

    }

    .slash-suggestion-popup{
        background-color: #272227;
        opacity: 0.7;
        width: 98%;
        border-radius: 16px 16px 0px 0px;
        color: white;
        padding: 24px 16px 12px 16px;
        font-family: 'Poppins';
        display: none;
    }
    .suggestoin-div{
        width: 100%;
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        font-size: 10px;
        padding-bottom: 6px;
        padding-top:6px;
        cursor: pointer;
    }
    .suggestoin-div:hover{
        background-color: #6f516f;
    }

    .floating-action-button-disabled {
        top: 0;
        right: 0;
        width: 30px;
        height: 30px;
        background: #89B4FA;
        opacity: 0.4;
        border-radius: 50%;
        text-align: center;
        line-height: 60px;
        color: white;
        font-size: 24px;
        cursor: pointer;
        box-shadow: 0px 3px 6px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        align-content: center;
    }

    .spinner {
        border: 8px solid #FDE4FF; /* Light grey */
        border-top: 8px solid #6f516f; /* Blue */
        border-radius: 50%;
        width: 60px;
        height: 60px;
        animation: spin 2s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
       
        100% { transform: rotate(360deg); }
    }

    

    #unlimited:hover{
        opacity: 0.5;
        cursor: pointer; 
    }
    .clip:hover{
        opacity: 0.6;
    }
    #remove_attachement:hover{
        opacity: 0.6;
    }

    .attachment_file_container {
            position: relative;
            display: inline-block;
        }

        .file_progress_overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90px;
            height: 90px;
        }

    .attachment_spinner {
        border: 3px solid #e406f4; /* Light grey */
        border-top: 3px solid #6f516f; /* Blue */
        border-radius: 7.5px;
        width: 15px;
        height: 15px;
        top: 30%;
        left: 26.25%;
        transform: translate(-50%, -50%);
        animation: spin 2s linear infinite;
        position: absolute;
       
    }

    /* Overlay styles */
    .pop-up-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                display:none;
                justify-content: center;
                align-items: center;
                background-color: var(--editor-background); /* or rgba(0, 0, 0, 0.8) */
                opacity: 0.7;
                z-index: 1000; /* Ensure it's above other content */
            }
            .pop-up-modal{
                width:50%;
                display:flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                border-radius: 6px;
                background-color: var(--editor-background);
                padding:33px;
            }
            .pop-up-modal-header{
                font-weight: bold;
                color: var(--editor-foreground);
                font-size: 18.75px;
                margin-bottom:16.5px;
                text-align: center;
            }
            .pop-up-modal-body-text{
                text-align: center;
                color: var(--editor-foreground);
                font-size: 12px;
                margin-bottom: 16.5px;
            }
            .pop-up-modal-upgrade-btn{
                width:50%;
                border-radius: 6px;
                border:0px;
                outline:'none';
                background-color: var(--button-background);
                color:var(--button-foreground);
                display: flex;
                justify-content: center;
                align-items: center;
                font-size: 12px;
                font-weight: bold;
                padding:15px 0px;
                margin-bottom: 7.5px;
            }
            .pop-up-modal-cancel-btn{
                width:50%;
                border-radius: 6px;
                border:0px;
                padding:15px 0px;
                outline:'none';
                background-color: var(--button-background);
                color:var(--button-foreground);
                display: flex;
                justify-content: center;
                align-items: center;
                font-size: 12px;
                font-weight: bold;
                margin-bottom: 7.5px;
            }

            .ai-message-box{
                        width:100%;
                        overflow-wrap: break-word;
                        /*background:#252525;*/
                        background:transparent;
                        color:var(--editor-foreground);
                        padding:0.5625rem;
                        border-radius:6px;
                        box-sizing: border-box;
            }

            .code-block {
                        position: relative;
                        background-color: var(--terminal-background);
                        color: var(--terminal-foreground);
                        border-radius: 6px;
                        margin-top: 0.45rem;
                        margin-bottom: 0.45rem;
                        margin-right: 0.75rem;
                        overflow: hidden;
                        padding-top: 1.5rem!important;
                        box-sizing: border-box;
                    }
            
            .code-toolbarr {
                        position: absolute;
                        top: 0;
                        left: 0;
                        right: 0;
                        background: var(--editor-background);
                        opacity: 0.8;
                        color: var(--editor-foreground);
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        padding: 0.375rem;
                        font-family: 'Roboto', sans-serif;
                        z-index: 10;
                        box-sizing: border-box;
                        border-bottom: 1px solid var(--editor-foreground);
                    }
            
            .code-toolbarr .toolbar-actions {
                        display: flex;
                        gap: 8px; /* Gap between buttons */
                        align-items: center;
                    }
            
            .code-toolbarr .toolbar-actions button {
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        background: transparent;
                        border: none;
                        color: var(--editor-foreground);
                        padding: 4px 6px; /* Reduced horizontal padding */
                        cursor: pointer;
                        opacity: 0.7;
                        font-size: 12px;
                        transition: opacity 0.2s;
                        gap: 0px; /* Remove gap between icon and text within button */
                    }
            
            .code-toolbarr .toolbar-actions button:hover {
                        opacity: 1;
                    }
            
            .code-toolbarr .language-name {
                        font-weight: 400;
                        color: var(--editor-foreground);
                        opacity: 0.6;
                    }

                    
                    pre[class*="language-"] {
                        background-color: transparent;
                        padding: 0.75rem;
                        box-sizing: border-box;
                      }
                    code[class*="language-"]{
                        background-color: transparent;
                        
                        
                    }

                textarea::placeholder {
                    overflow: hidden;
                    white-space: nowrap;
                    text-overflow: ellipsis;
                    display: block; /* Ensures block layout for the placeholder text */
                }

            /* Media query for extra large screens */
            @media (min-width: 637.5px) {
                .pop-up-modal {
                    width: 37.5%;
                }
            }

            /* Media query for smaller screens */
            @media (max-width: 450px) {
                .pop-up-modal {
                    width: 67.5%;
                }
            }



            .usecase-span{
                font-size: 7.5px; 
                color: #CDD6F4;
                font-weight: 300;
                font-family: 'Poppins';
            }
            /* Dropdown Container */
            #mention-dropdown {
                position: absolute;
                bottom: 75px; /* Adjust based on textarea height */
                left: 7.5px;
                width: calc(100% - 15px);
                background-color: #1d1e2a;
                border: 0.75px solid rgba(84, 84, 197, 1);
                border-radius: 6px;
                box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
                max-height: 112.5px;
                overflow-y: auto;
                z-index: 1000;
                display: none;
            }

            /* Mention Items */
            .mention-item {
                padding: 6px 9px;
                color: aliceblue;
                font-size: 9px;
                cursor: pointer;
                display: flex;
                align-items: center;
            }

            .mention-item-span{
                display: inline-block;
                margin-left: 3.75px;
                font-size: 9.75px;
                font-weight: bold;
                color:#32B76C;
            }

            .mention-item:hover {
                background-color: rgba(84, 84, 197, 0.2);
                color: #fff;
            }

            .mention {
                font-weight: bold;
                color: #4A90E2; /* A blue color compatible with the UI */
            }

            .history_icon{
                color: FDE4FF;
            }
            .history_icon:hover{
                transform: scale(1.15);
            }

            .previous-chat-span::after {
                content: attr(title);
                position: absolute;
                left: 50%;
                margin-top: 30px;
                transform: translateX(-50%);
                background-color: #313244; /* Match modal background */
                color: #CDD6F4; /* Match text color */
                padding: 3.75px 7.5px;
                border-radius: 3.75px;
                opacity: 0;
                transition: opacity 0.3s;
                font-size: 7.5px;
                height: fit-content;
                margin-top: 42px;
                line-height: 12px;
                text-align: left;
            }
            .previous-chat-span:hover::after {
                opacity: 1;
                height: fit-content;
              
                line-height: 12px;
            }

    /* Show text for Apply button only */
    .code-toolbarr .toolbar-actions button[title="Apply"] span {
        display: inline;
        font-size: 11px;
        color: var(--editor-foreground);
    }

    /* Add a small space only between icon and text in Apply button */
    .code-toolbarr .toolbar-actions button[title="Apply"] i {
        margin-right: 2px;
    }
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

<!-- Add this style section -->
<style>
    /* File icons container */
    .file-icon {
        display: inline-flex;
        align-items: center;
        width: 16px;
        height: 16px;
        padding:0px;
    }

    

    /* File type icons - Add more as needed */
    .file-icon svg {
        width: 16px;
        height: 16px;
    }
</style>

<style>
    /* Update textarea container styles */
    .textarea-container {
        display: flex;
        flex-direction: column;
        background: var(--editor-background);
        border: 0.75px solid rgba(255, 255, 255, 0.1);
        margin: 0 12px 12px 12px;
        padding: 0;
        position: relative;
        min-height: 72px;
        max-height: 300px;
    }

    /* Update textarea styles */
    .textarea-container textarea {
        flex-grow: 1;
        background: transparent;
        border: none;
        color: var(--input-foreground);
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        font-size: 11.25px;
        line-height: 20px;
        padding: 6px 7.5px;
        resize: none;
        outline: none;
        min-height: 20px;
    }

    /* Add styles for scrollable state */
    .textarea-container textarea.scrollable {
        overflow-y: scroll;
        scrollbar-width: none; /* Firefox */
        -ms-overflow-style: none; /* IE and Edge */
    }

    .textarea-container textarea.scrollable::-webkit-scrollbar {
        display: none; /* Chrome, Safari, Opera */
    }

    textarea::placeholder {
        color: rgba(255, 255, 255, 0.4);
    }

    textarea::-webkit-scrollbar {
        width: 4px;
    }

    textarea::-webkit-scrollbar-track {
        background: transparent;
    }

    textarea::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.2);
        border-radius: 2px;
    }

    /* Add styles for the send button */
    .send-button {
        display: flex;
        align-items: center;
        justify-content: center;
        background: transparent;
        border: none;
        padding: 3px;
        margin-left: 6px;
        cursor: pointer;
        opacity: 0.8;
        transition: opacity 0.2s;
        background-color: var(--button-background);
    }

    .send-button:hover {
        opacity: 1;
    }

    .send-button svg {
        width: 15px;
        height: 15px;
        fill: var(--input-foreground);
    }

    /* Add hover effect for textarea container */
    .textarea-container:focus-within {
        border-color: rgba(255, 255, 255, 0.2);
    }

    /* Ensure the container stays at bottom */
    .input-wrapper {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: var(--editor-background);
        padding: 0;
        border-top: 0.75px solid rgba(255, 255, 255, 0.1);
    }

    .dynamic-input-wrapper{
        background: var(--editor-background);
        padding: 0;
        border-bottom: 0.75px solid rgba(255, 255, 255, 0.1);
        width: 100%;
        display: flex;
        flex-direction: column;
    }
</style>

<!-- Add these styles to the existing <style> section -->
<style>
    /* Context section styles */
    .context-section {
        display: flex;
        padding: 0 6px;
        height: 100%;
        width: 100%;
        align-items: left;
        justify-content: left;
        padding-top: 3px;
        background-color: var(--editor-background);
    }

    .context-chip {
        display: flex;
        border-radius: 3px;
        justify-content: left;
        align-items: center;
        margin: 3px;
        font-size: 9px;
        color: var(--editor-foreground);
        background-color:var(--editor-background);
        cursor: pointer;
    }

    .dynamic-context-chip{
        display: flex;
        border-radius: 3px;
        justify-content: left;
        align-items: center;
        margin: 1.5px;
        font-size: 9px;
        color: var(--editor-foreground);
        background-color:var(--editor-background);
        cursor: pointer;
    }

    .context-label {
        color: var(--editor-foreground);
        text-align: left;
        background-color: var(--editor-background);
        margin-right: 0px;
        padding: 1.5px 3px;
    }

    .context-name {
        color: #9399B2; 
        text-align: left;
        display: flex;
        text-align: left;
        font-family: 'Poppins';
        font-weight: 500;
    }


    .context-close {
        display: flex;
        align-items: center;
        justify-content: center;
        background: none;
        border: none;
        padding: 1.5px;
        color: var(--editor-foreground);
        opacity: 0.7;
        cursor: pointer;
        margin-left: 0px;
        width: 7.5px;
    }

    .context-close:hover {
        opacity: 1;
    }

    /* Update textarea-container styles */
    .textarea-container {
        display: flex;
        flex-direction: column;
        justify-content: left;
        background: var(--editor-background);
        border: 0.75px solid rgba(255, 255, 255, 0.1);
        margin: 0 12px 12px 12px;
        padding: 0;
        position: relative;
        height: auto;
        min-height: 100px;
    }

    /* Update textarea styles to work with new layout */
    .textarea-container textarea {
        padding: 6px 7.5px;
        min-height: 52.5px;
        border: none;
        background: transparent;
        height: auto;
    }

    /* Update send button positioning */
    .send-button {
        position: absolute;
        right: 18px;
        bottom: 6px;
    }
</style>

<style>
    .context-dropup {
        position: absolute;
        bottom: 100%;
        left: 0;
        width: 225px;
        max-height: 300px;
        background: var(--input-background);
        border-radius: 4.5px;
        margin-bottom: 6px;
        overflow: hidden;
        box-shadow: 0 -1.5px 7.5px rgba(0, 0, 0, 0.1);
        z-index: 50000;
    }

    .dynamic-context-dropup {
        position: absolute;
        left: 0;
        top: 26.25%;
        width: 225px;
        max-height: 300px;
        background: var(--input-background);
        border-radius: 4.5px;
        margin-bottom: 6px;
        overflow: hidden;
        box-shadow: 0 -1.5px 7.5px rgba(0, 0, 0, 0.1);
        background-color: var(--editor-background);
        z-index: 50000;
        
    }

    .dropup-section {
        padding: 6px 0;
    }

    .section-header {
        padding: 3px 9px;
        font-size: 9px;
        font-weight: 600;
        color: var(--editor-foreground);
        opacity: 0.7;
    }

    .section-content {
        max-height: 112.5px;
        overflow-y: auto;
    }

    .file-item {
        padding: 4.5px 9px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: space-between;
        color: var(--editor-foreground);
        font-size: 8.25px;
        background: var(--input-background);
    }

    .file-item-left {
        display: flex;
        align-items: center;
        gap: 4.5px;
        min-width: 0;
    }

    .file-name {
        display: flex;
        align-items: center;
        gap: 0px;
        padding:0px;
    }

    .file-path {
        color: var(--editor-foreground);
        opacity: 0.5;
        font-size: 8.25px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .file-icon {
        font-size: 14px;
        opacity: 0.7;
    }

    .file-icon-light{
        opacity: 1.0;
    }
    .file-item:hover {
        background: var(--button-background);
        opacity: 0.8;
    }

    .file-item.selected {
        background: var(--input-background);
    }
</style>

<style>
    /* Update the search input styles */
    .search-container {
        padding: 6px;
        border-bottom: 0.75px solid var(--input-border);
    }

    .search-input {
        width: 100%;
        padding: 4.5px 6px;
        border: 0.75px solid var(--input-border);
        border-radius: 3px;
        background: var(--editor-background);
        background-color: var(--editor-background);
        color: var(--input-foreground);
        font-size: 9px;
        font-family: 'Poppins';
    }

    .search-input::placeholder {
        color: var(--input-foreground);
        opacity: 0.6;
    }

    .search-input:focus {
        outline: none;
        border-color: var(--button-background);
    }
</style>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/devicons/devicon@latest/devicon.min.css">

<script>
    
function getFileIcon(fileName) {
    const fileNameParts = fileName.split(' ');
    const actualFileName = fileNameParts[0];
    const ext = actualFileName.split('.').pop()?.toLowerCase();
    switch(ext) {
        // Web Development
        case 'html':
        case 'htm':
            return '<i class="devicon-html5-plain colored" style="font-size: 11px;"></i>';
        case 'css':
        case 'scss':
        case 'sass':
        case 'less':
            return '<i class="devicon-css3-plain colored" style="font-size: 11px;"></i>';
        case 'js':
        case 'mjs':
        case 'cjs':
            return '<i class="devicon-javascript-plain colored" style="font-size: 11px;"></i>';
        case 'jsx':
            return '<i class="devicon-react-original colored" style="font-size: 11px;"></i>';
        case 'ts':
            return '<i class="devicon-typescript-plain colored" style="font-size: 11px;"></i>';
        case 'tsx':
            return '<i class="devicon-typescript-plain colored" style="font-size: 11px;"></i>';

        // Python and Related
        case 'py':
        case 'pyw':
        case 'pyc':
        case 'pyd':
        case 'pyo':
        case 'pyx':
            return '<i class="devicon-python-plain colored" style="font-size: 11px;"></i>';
        case 'ipynb':
            return '<i class="devicon-jupyter-plain colored" style="font-size: 11px;"></i>';

        // Java and JVM
        case 'java':
        case 'class':
        case 'jar':
            return '<i class="devicon-java-plain colored" style="font-size: 11px;"></i>';
        case 'kt':
        case 'kts':
            return '<i class="devicon-kotlin-plain colored" style="font-size: 11px;"></i>';
        case 'scala':
        case 'sc':
            return '<i class="devicon-scala-plain colored" style="font-size:11px;"></i>';
        case 'groovy':
            return '<i class="devicon-groovy-plain colored" style="font-size: 11px;"></i>';

        // C-family
        case 'c':
            return '<i class="devicon-c-plain colored" style="font-size: 11px;"></i>';
        case 'cpp':
        case 'cc':
        case 'cxx':
        case 'h':
        case 'hpp':
        case 'hxx':
            return '<i class="devicon-cplusplus-plain colored" style="font-size: 11px;"></i>';
        case 'cs':
            return '<i class="devicon-csharp-plain colored" style="font-size: 11px;"></i>';
        case 'swift':
            return '<i class="devicon-swift-plain colored" style="font-size: 11px;"></i>';
        case 'm':
        case 'mm':
            return '<i class="devicon-objectivec-plain colored" style="font-size: 11px;"></i>';

        // System Programming
        case 'rs':
        case 'rlib':
            return '<i class="devicon-rust-plain colored" style="font-size: 11px;"></i>';
        case 'go':
            return '<i class="devicon-go-plain colored" style="font-size: 11px;"></i>';
        case 'zig':
            return '<i class="devicon-zig-plain colored" style="font-size: 11px;"></i>';

        // Scripting Languages
        case 'php':
        case 'phtml':
        case 'php3':
        case 'php4':
        case 'php5':
        case 'php7':
        case 'phps':
            return '<i class="devicon-php-plain colored" style="font-size: 11px;"></i>';
        case 'rb':
        case 'rbw':
        case 'rake':
        case 'gemspec':
            return '<i class="devicon-ruby-plain colored" style="font-size: 11px;"></i>';
        case 'pl':
        case 'pm':
        case 'perl':
            return '<i class="devicon-perl-plain colored" style="font-size: 11px;"></i>';
        case 'lua':
            return '<i class="devicon-lua-plain colored" style="font-size: 11px;"></i>';

        // Shell Scripts
        case 'sh':
        case 'bash':
        case 'zsh':
        case 'fish':
            return '<i class="devicon-bash-plain" style="font-size: 11px; color: #89e051;"></i>';
        case 'ps1':
        case 'psm1':
        case 'psd1':
            return '<i class="devicon-powershell-plain" style="font-size: 11px; color: #1A5FFF;"></i>';

        // Web Frameworks
        case 'vue':
            return '<i class="devicon-vuejs-plain colored" style="font-size: 11px;"></i>';
        case 'svelte':
            return '<i class="devicon-svelte-plain colored" style="font-size: 11px;"></i>';
        case 'angular':
            return '<i class="devicon-angularjs-plain colored" style="font-size:11px;"></i>';

        // Mobile Development
        case 'dart':
            return '<i class="devicon-dart-plain colored" style="font-size: 11px;"></i>';
        case 'kotlin':
            return '<i class="devicon-kotlin-plain colored" style="font-size: 11px;"></i>';

        // Functional Programming
        case 'hs':
        case 'lhs':
            return '<i class="devicon-haskell-plain colored" style="font-size: 11px;"></i>';
        case 'ex':
        case 'exs':
            return '<i class="devicon-elixir-plain colored" style="font-size: 11px;"></i>';
        case 'erl':
        case 'hrl':
            return '<i class="devicon-erlang-plain colored" style="font-size: 11px;"></i>';
        case 'clj':
        case 'cljs':
            return '<i class="devicon-clojure-plain colored" style="font-size: 11px;"></i>';

        // Data/Config Files
        case 'json':
        case 'jsonc':
            return '<i class="devicon-javascript-plain" style="font-size: 11px; color: #fbc02d;"></i>';
        case 'yaml':
        case 'yml':
            return '<i class="fas fa-file-code" style="font-size: 11px; color: #9C27B0;"></i>';
        case 'xml':
            return '<i class="fas fa-file-code" style="font-size: 11px; color: #FF5722;"></i>';
        case 'toml':
            return '<i class="fas fa-cog" style="font-size: 11px; color: #607D8B;"></i>';

        // Database
        case 'sql':
        case 'mysql':
        case 'pgsql':
            return '<i class="devicon-mysql-plain colored" style="font-size: 11px;"></i>';
        case 'mongodb':
            return '<i class="devicon-mongodb-plain colored" style="font-size: 11px;"></i>';
        case 'redis':
            return '<i class="devicon-redis-plain colored" style="font-size: 11px;"></i>';

        // Documentation
        case 'md':
        case 'markdown':
            return '<i class="devicon-markdown-original" style="font-size: 11px;"></i>';
        case 'rst':
            return '<i class="fas fa-file-alt" style="font-size: 11px; color: #42A5F5;"></i>';
        case 'tex':
            return '<i class="devicon-latex-plain colored" style="font-size: 11px;"></i>';

        // Other Languages
        case 'r':
            return '<i class="devicon-r-plain colored" style="font-size: 11px;"></i>';
        case 'jl':
            return '<i class="devicon-julia-plain colored" style="font-size: 11px;"></i>';
        case 'matlab':
        case 'm':
            return '<i class="devicon-matlab-plain colored" style="font-size: 11px;"></i>';
        case 'f':
        case 'f90':
        case 'f95':
        case 'f03':
            return '<i class="devicon-fortran-plain colored" style="font-size: 11px;"></i>';
        case 'v':
        case 'sv':
        case 'vh':
        case 'svh':
            return '<i class="devicon-verilog-plain colored" style="font-size: 11px;"></i>';
        case 'png':
        case 'jpg':
        case 'jpeg':
        case 'gif':
        case 'bmp':
        case 'svg':
            case 'ico':
            case 'webp':
            case 'tiff':
            case 'raw':
                return '<i class="fas fa-image" style="font-size: 11px; color: #4CAF50;"></i>';

            // Document files
            case 'pdf':
                return '<i class="fas fa-file-pdf" style="font-size: 11px; color: #FF5722;"></i>';
            case 'doc':
            case 'docx':
                return '<i class="fas fa-file-word" style="font-size: 11px; color: #2196F3;"></i>';
            case 'xls':
        case 'xlsx':
            return '<i class="fas fa-file-excel" style="font-size: 11px; color: #4CAF50;"></i>';
        case 'ppt':
        case 'pptx':
            return '<i class="fas fa-file-powerpoint" style="font-size: 11px; color: #FF5722;"></i>';

            // Archive files
            case 'zip':
            case 'rar':
            case '7z':
            case 'tar':
            case 'gz':
                return '<i class="fas fa-file-archive" style="font-size: 11px; color: #FFC107;"></i>';

            // Config files
            case 'xml':
                return '<i class="devicon-xml-plain" style="font-size: 11px; color: #FF5722;"></i>';
            case 'yaml':
            case 'yml':
                return '<i class="fas fa-file-code" style="font-size: 11px; color: #9C27B0;"></i>';
            case 'toml':
            case 'ini':
            case 'conf':
                return '<i class="fas fa-cog" style="font-size: 11px; color: #607D8B;"></i>';

            // Database files
            case 'db':
            case 'sqlite':
            case 'sqlite3':
                return '<i class="fas fa-database" style="font-size: 11px; color: #2196F3;"></i>';

            // Video files
            case 'mp4':
            case 'avi':
            case 'mov':
            case 'wmv':
            case 'flv':
            case 'mkv':
            case 'webm':
                return '<i class="fas fa-file-video" style="font-size: 11px; color: #E91E63;"></i>';

            // Audio files
            case 'mp3':
            case 'wav':
            case 'ogg':
            case 'm4a':
            case 'flac':
            case 'aac':
                return '<i class="fas fa-file-audio" style="font-size: 11px; color: #9C27B0;"></i>';

            // Font files
            case 'ttf':
            case 'otf':
            case 'woff':
            case 'woff2':
            case 'eot':
                return '<i class="fas fa-font" style="font-size: 11px; color: #795548;"></i>';


        // Default for unknown extensions
        default:
            return '<i class="devicon-git-plain" style="font-size: 11px; color: #666;"></i>';
    }
}
</script>

<style>
    .file-name {
        display: flex;
        align-items: center;
        gap: 0px;  /* Increased gap for better spacing with icons */
        padding:0px;
    }

    .file-name i {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 12px;
        height: 12px;
        margin-right: 0px;
        padding:0px;
    }
</style>

<!-- Add these styles in the existing <style> section -->
<style>
    /* Context section container */
    .context-section {
        display: flex;
        padding: 6px;
        width: 100%;
        align-items: center;
        overflow-x: auto;
        scrollbar-width: none; /* Firefox */
        -ms-overflow-style: none; /* IE and Edge */
        background-color: var(--editor-background);
    }

    .context-section::-webkit-scrollbar {
        display: none; /* Chrome, Safari, Opera */
    }

    /* Context chips container */
    .context-chips {
        display: flex;
        gap: 6px;
        overflow-x: auto;
        scrollbar-width: none;
        -ms-overflow-style: none;
        flex-grow: 1;
        cursor: pointer;
    }

    .dynamic-context-chips{
        display: flex;
        gap: 6px;
        overflow-x: auto;
        scrollbar-width: none;
        -ms-overflow-style: none;
        flex-grow: 1;
        cursor: pointer;
    }

    .dynamic-context-chip{
        display: flex;
        align-items: center;
        padding: 1.5px 3px;
        background: var(--editor-background);
        border: 0.75px solid var(--input-foreground);
        border-radius: 3px;
        margin-right: 3px;
        white-space: nowrap;
        opacity: 0.7;
        cursor: pointer;
    }

    .context-chips::-webkit-scrollbar {
        display: none;
    }

    /* Individual context chip */
    .context-chip {
        display: flex;
        align-items: center;
        padding: 1.5px 3px;
        background: var(--editor-background);
        border: 0.75px solid var(--input-foreground);
        border-radius: 3px;
        margin-right: 3px;
        white-space: nowrap;
        opacity: 0.7;
        cursor: pointer;
    }

    .context-chip:hover {
        opacity: 1;
    }
    .dynamic-context-chip:hover {
        opacity: 1;
    }

    .context-chip .file-icon {
        margin-right: 0px;
    }
    .dynamic-context-chip .file-icon {
        margin-right: 2px;
    }

    .context-chip .file-name {
        color: var(--editor-foreground);
        margin-right:0px;
        font-weight: 600;
    }

    .dynamic-context-chip .file-name {
        color: var(--editor-foreground);
        margin-right: 0px;
        font-weight: 600;
    }

    .context-chip .remove-button {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 12px;
        height: 12px;
        border: none;
        background: none;
        color: var(--editor-foreground);
        cursor: pointer;
        opacity: 0.7;
        padding: 1.5px;
        margin-left: 3px;
        margin-right: 3px;
    }

    .dynamic-context-chip .remove-button:hover {
        opacity: 1;
    }

    .dynamic-context-chip .remove-button {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 12px;
        height: 12px;
        border: none;
        background: none;
        color: var(--editor-foreground);
        cursor: pointer;
        opacity: 0.7;
        padding: 3px;
        margin-left: 3px;
    }

    .context-chip .remove-button:hover {
        opacity: 1;
    }
</style>



<style>
    .code-preview-dropup {
        position: absolute;
        bottom: 100%;
        left: 0;
        right: 0;
        background-color: var(--editor-background);
        border: 0.75px solid var(--input-foreground);
        border-radius: 3px;
        margin-bottom: 6px;
        max-height: 225px;
        overflow-y: auto;
        z-index: 1000;
    }

    .dynamic-code-preview-dropup{
        position: absolute;
        top: 26.25%;
        left: 0;
        right: 0;
        background-color: var(--editor-background);
        border: 0.75px solid var(--input-foreground);
        border-radius: 3px;
        margin-bottom: 6px;
        max-height: 225px;
        overflow-y: auto;
        z-index: 5000;
    }

    .dynamic-context-dropup::-webkit-scrollbar {
        display: none;
    }

    

    .code-preview-actions {
        position: absolute;
        top: 6px;
        right: 6px;
        display: none;
        gap: 3px;
        padding: 3px;
        border-radius: 3px;
        background-color: var(--editor-background);
        border: 0.75px solid var(--input-foreground);
        background: var(--editor-background);
    }

    .code-preview-dropup:hover .code-preview-actions {
        display: flex;
    }

    .preview-action-btn {
        background-color: var(--editor-background);
        border: none;
        color: var(--input-foreground);
        padding: 3px 6px;
        cursor: pointer;
        border-radius: 3px;
        opacity: 0.7;
        background: var(--editor-background);
        z-index: 10000;
    }

    .preview-action-btn:hover {
        opacity: 1;
        background: var(--editor-background);
    }

    .preview-action-btn:hover{
        background: var(--editor-background);
    }

    .code-preview-content {
        background-color: var(--editor-background);
        padding: 10px;
        border-radius: 4px;
        margin-top: 10px;
        font-size: 9px; /* Scaled down by 0.75 */
        overflow-x: auto;
    }

    .dynamic-code-preview-content {
        background-color: var(--editor-background);
        padding: 10px;
        border-radius: 4px;
        margin-top: 10px;
        font-size: 9px; /* Scaled down by 0.75 */
        overflow-x: auto;
    }

    .code-preview-content code,
    .dynamic-code-preview-content code {
        font-size: 9px; /* Scaled down by 0.75 */
    }

    .preview-action-btn-text{
        font-size: 7.5px;
        font-weight: 600;   
        color: var(--input-foreground);
        margin-right: 1.5px;
        margin-left: 1.5px;
        margin-top: 1.5px;
        margin-bottom: 1.5px;
    }
    .spinner-container {
        display: none;
        align-items: center;
        gap: 2px;
        margin: 10px 0;
        z-index: 1990000;
    }

    .generating-spinner {
        width: 14px;
        height: 14px;
        border: 2px solid rgba(255, 255, 255, 0.919); /* Light grey */
        border-top: 2px solid var(--input-foreground); /* Blue */
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    .show{
        display: flex;
    }
</style>



<script>
    var allAddedFiles = [];
    function updateContextChips(files) {
        // try{
        //     allAddedFiles = allAddedFiles.push(files)
        // }catch(e){
        //     vscode.postMessage({
        //         command: "log_event",
        //         value: `###INFO Error in updateContextChips ${e}`,
        //     });
        // }
        allAddedFiles = files;
        vscode.postMessage({
            command: "log_event",
            value: `###INFO updateContextChips allAddedFiles is ${allAddedFiles}`,
        });
        try{
            const contextSection = document.getElementById('context-section');
            const addContextChip = document.querySelector('.context-chip');
            var chipsContainer = document.getElementById('context-chips');
            
            // Create chips container if it doesn't exist
            if (!chipsContainer) {
                const newChipsContainer = document.createElement('div');
                newChipsContainer.id = 'context-chips';
                newChipsContainer.className = 'context-chips';
                contextSection.appendChild(newChipsContainer);
            }
            
            // Get the container (whether existing or newly created)
            const container = document.getElementById('context-chips');
            container.innerHTML = '';
            
            if (allAddedFiles.length > 0) {
                // Hide the "Add context" text but keep the + button
                const contextName = addContextChip.querySelector('.context-name');
                if (contextName) {
                    contextName.style.display = 'none';
                }
                
                // Add chips for each file
                allAddedFiles.forEach(fsss => {
                    vscode.postMessage({
                        command: "log_event",
                        value: `###INFO updateContextChips fsss is ${fsss}`,
                    });
                    const fileName = fsss.split('/').pop();
                    const chip = document.createElement('div');
                    chip.className = 'context-chip';
                    chip.innerHTML = `
                        <span class="file-icon">${getFileIcon(fileName)}</span>
                        <span class="file-name">${fileName}</span>
                        <button class="remove-button" onclick="removeFileContext('${fsss}', event)">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                   
                    chip.onclick = () => onChipClick(fsss);
                    container.appendChild(chip);
                    container.style.display = 'flex';
                    contextSection.appendChild(container);

                    vscode.postMessage({
                        command: "log_event",
                        value: `###INFO updateContextChips APPEND CHULKLLEEE ${container} contextSection is ${contextSection}`,
                    });
                });
            } else {
                vscode.postMessage({
                command: "log_event",
                value: `###INFO updateContextChips empty path ${allAddedFiles}`,
            });
                // Show the "Add context" text
                const contextName = addContextChip.querySelector('.context-name');
                if (contextName) {
                    contextName.style.display = 'block';
                }
                container.style.display = 'none';
            }
    }catch(e){
        vscode.postMessage({
            command: "log_event",
            value: `###INFO Error in updateContextChips ${e}`,
        });
    }
    
}


function removeFileContext(fileName, event) {
    // Prevent the click from triggering the parent's onclick
    event.stopPropagation();
    
    vscode.postMessage({
        command: 'remove_file_context',
        value: fileName
    });
}

</script>
</head>

<body>
    <div id="pop-up-overlay" class="pop-up-overlay">
        <div class="pop-up-modal" id="pop-up-modal">
            <div class="pop-up-modal-header" id="pop-up-modal-header">
                Unlock Full Chat Access!
            </div>
            <div class="pop-up-modal-body-text" id="pop-up-modal-body-text">
                To enjoy unlimited use of the chat feature, please upgrade to our premium plan for just $9.99.<br/><br/>
                Your upgrade will give you access to all of our chat tools, personalized support, and more—helping you make the most of your experience.
            </div>
            <button class="pop-up-modal-upgrade-btn" onclick="onClick('useCase', 'GPT40_UPGRADE')">Upgrade</button>
            <button class="pop-up-modal-cancel-btn" onclick="removePopUp()">Cancel</button>
        </div>
    </div>

    <div class="status-bar">
        <div class="status-bar-left">
            <button class="tab active" onclick="switchTab('chat')">CHAT</button>
            <button class="tab" onclick="switchTab('composer')">COMPOSER</button>
            <button class="tab" onclick="switchTab('bug-finder')">BUG FINDER</button>
        </div>
        <div class="status-bar-right">
            <div class="status-bar-icon" onclick="addNewTab()">
                <i class="fas fa-plus"></i>
            </div>
            <div class="status-bar-icon" onclick="showHistory()">
                <i class="fas fa-clock"></i>
            </div>
            <div class="status-bar-icon" onclick="showMenu()">
                <i class="fas fa-ellipsis"></i>
            </div>
            <div class="status-bar-icon" onclick="closePanel()">
                <i class="fas fa-xmark"></i>
            </div>
        </div>
    </div>
    <div id="container" class="container">
        <div id="chat" class="chat">

            <div id="messages" class="messages"></div>
           
            <div class="slash-suggestion-popup" id="slash-suggestion-popup">
                
            </div>
           
            <div class="input-wrapper" id="input-wrapper">
                <div class="textarea-container">
                    <!-- Add the context section here -->
                    <div class="context-section" id="context-section">
                        <div class="code-preview-dropup" id="code-preview-dropup" style="display: none;">
                            <div class="code-preview-actions">
                                <button class="preview-action-btn" onclick="openFileInWorkspace()">
                                    <i class="fas fa-external-link-alt"></i><span class="preview-action-btn-text">Open</span>
                                </button>
                                <button class="preview-action-btn" onclick="collapseCodePreview()">
                                    <i class="fas fa-chevron-up"></i> <span class="preview-action-btn-text">Collapse</span>
                                </button>
                                <button class="preview-action-btn" onclick="removeFileContext(currentPreviewFile, event)">
                                    <i class="fas fa-times"></i><span class="preview-action-btn-text">Remove</span>
                                </button>
                            </div>
                            <pre class="code-preview-content"><code id="preview-code"></code></pre>
                        </div>
                        <div class="context-chip" onclick="selectFileContext()">
                            <div class="context-label">+</div>
                            <div class="context-name">Add context</div>
                           
                        </div>
                        <!-- Add the dropup menu -->
                        <div class="context-dropup" id="context-dropup" style="display: none;">
                            <div class="search-container">
                                <input type="text" 
                                       class="search-input" 
                                       id="file-search" 
                                       placeholder="Search files by name"
                                       oninput="filterFiles(this.value)">
                            </div>
                            <div class="dropup-section">
                                <div class="section-header">ADDED</div>
                                <div class="section-content" id="added-files">
                                    <!-- Added files will be listed here -->
                                </div>
                            </div>
                            <div class="dropup-section">
                                <div class="section-header">AVAILABLE</div>
                                <div class="section-content" id="available-files">
                                    <!-- Available files will be listed here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Existing textarea and send button -->
                    <textarea 
                        id="input"
                        placeholder="Type '/' for commands, '@' for links you uploaded or simply type."
                        rows="1"
                    ></textarea>
                    <button class="send-button" id="send-button" onclick="sendMessage()">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <div class="dropdown" id="mention-dropdown">
            <!-- Dropdown Content -->
        </div>

        <div style=" 
        position: absolute;
        bottom: 0;
        display: flex;
        margin-right: 24px;
        margin-bottom: 12px;
        margin-top: 8px;
        right: 0;
        align-items: center;">
            <span id="unlimited" style="display: none; cursor: pointer; color: #e69191; margin: 0px; font-size: 12px; padding-left: 4px; text-decoration: underline;" onclick="showUploadFileModal('JIRA')"> seems you are out of tokens, click here to get more 😌</span>
        
          
        </div>
       
    </div>
    <div class="addCodemodal" id="addCodemodal">
        <div class="modal-content">
            <span class="close" style="margin-bottom: 5px;" onclick="hideAddCodeModal()">&times;</span>
            <h4 style="font-family: 'Roboto', 'Oxygen',
          'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', Arial, Helvetica,
          sans-serif;">Add code snippet to your code</h4>
            <h5 style="font-family: 'Roboto', 'Oxygen',
          'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', Arial, Helvetica,
          sans-serif; margin-left: 0px; margin-bottom: 0px; margin-top: 30px; text-align: left; font-weight: 400;">What
                line should the code snippet start from?</h5>
            <input type="number" class="line-number-input" id="line-number-input" placeholder="enter line number"
                style="width: 100%; margin-bottom: 40px; height: 34px;"></input>
            <div style="display: flex; flex-direction: column;">
                <button class="gen-button" id="modal-button-id" style="height: 34px;" onclick="addCode(false,this)"> Add to code
                    instantly</button>
                <button class="gen-button" id="modal-button-two-id" style="height: 34px;" onclick="addCode(true,this)"> View Diff instead</button>
            </div>
        </div>
    </div>

    <div class="overlay" id="overlay" style="display: none; justify-content:center; align-items:center;">
        <div class="spinner" id="spinner" style="display: none;"></div>
    </div>
</body>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<!-- Prism.js Autoloader Plugin -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js" integrity="sha512-SkmBfuA2hqjzEVpmnMt/LINrjop3GKWqsuLSSB3e7iBmYK7JuWw4ldmmxwD9mdm2IRTTi0OxSAfEGvgEi0i2Kw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
    // Add these new functions
    let currentPreviewFile = '';
    
    function showCodePreview(filePath, content, isImage = false) {
        const previewDropup = document.getElementById('code-preview-dropup');
        const previewContent = document.getElementById('preview-code');
        
        if (isImage) {
            if (filePath.toLowerCase().endsWith('.svg')) {
                // For SVG files, we can safely render the content as HTML
                previewContent.innerHTML = `
                    <div class="image-preview-container svg-container">
                        ${content} <!-- Direct SVG content -->
                    </div>
                `;
            } else {
                // For other image types, use img tag
                previewContent.innerHTML = `
                    <div class="image-preview-container">
                        <img src="${content}" alt="${filePath}" />
                    </div>
                `;
            }
        } else {
            // Set the language class and content
            const language = getLanguageFromPath(filePath);
            previewContent.className = `language-${language}`;
            previewContent.textContent = content;
            
            // Apply syntax highlighting
            Prism.highlightElement(previewContent);
        }
        
        previewDropup.style.display = 'block';
        currentPreviewFile = filePath;
    }

    function showCodePreviewWithId(id, filePath, content, isImage = false) {
        const previewDropup = document.getElementById('code-preview-dropup-'+id);
        const previewContent = document.getElementById('preview-code-'+id);
        
        if (isImage) {
            if (filePath.toLowerCase().endsWith('.svg')) {
                // For SVG files, we can safely render the content as HTML
                previewContent.innerHTML = `
                    <div class="image-preview-container svg-container">
                        ${content} <!-- Direct SVG content -->
                    </div>
                `;
            } else {
                // For other image types, use img tag
                previewContent.innerHTML = `
                    <div class="image-preview-container">
                        <img src="${content}" alt="${filePath}" />
                    </div>
                `;
            }
        } else {
            // Set the language class and content
            const language = getLanguageFromPath(filePath);
            previewContent.className = `language-${language}`;
            previewContent.textContent = content;
            
            // Apply syntax highlighting
            Prism.highlightElement(previewContent);
        }
        
        previewDropup.style.display = 'block';
        currentPreviewFile = filePath;
    }
    
    function collapseCodePreview() {
        const previewDropup = document.getElementById('code-preview-dropup');
        previewDropup.style.display = 'none';
    }

    function collapseCodePreviewWithId(id) {
        const previewDropup = document.getElementById('code-preview-dropup-'+id);
        previewDropup.style.display = 'none';
    }
    
    function openFileInWorkspace() {
        vscode.postMessage({
            command: 'open_file',
            value: currentPreviewFile
        });
    }
    
    function getLanguageFromPath(filePath) {
        const ext = filePath.split('.').pop().toLowerCase();
        const languageMap = {
            'js': 'javascript',
            'ts': 'typescript',
            'py': 'python',
            'html': 'html',
            'css': 'css',
            // Add more mappings as needed
        };
        return languageMap[ext] || 'plaintext';
    }
    
    // Modify the existing chip click handler
    function onChipClick(filePath) {
        const previewDropup = document.getElementById('code-preview-dropup');
        const isPreviewVisible = previewDropup.style.display === 'block';
        
        // If preview is visible and it's the same file, close it
        if (isPreviewVisible && currentPreviewFile === filePath) {
            collapseCodePreview();
            return;
        }
        
        var contextDropup = document.getElementById("context-dropup")
        contextDropup.style.display = "none"
        vscode.postMessage({
            command: 'preview_file',
            value: filePath
        });
    }

    function onChipClickWithId(id, filePath) {
        vscode.postMessage({
            command: 'log_event',
            value: "###PREVIEWWWWWWWIDD Checking if onChipClickWithIdCALLLED 111"
        })
        try{
            const previewDropup = document.getElementById('code-preview-dropup-'+id);
            const isPreviewVisible = previewDropup.style.display === 'block';
            
            // If preview is visible and it's the same file, close it
            if (isPreviewVisible && currentPreviewFile === filePath) {
                collapseCodePreviewWithId(id);
                return;
            }
            
            var contextDropup = document.getElementById("context-dropup-"+id)
            contextDropup.style.display = "none"
            vscode.postMessage({
                command: 'log_event',
                value: "###PREVIEWWWWWWWIDD Checking if onChipClickWithId 111"
            })
            vscode.postMessage({
                command: 'preview_file_with_id',
                value: {
                        filePath: filePath,
                        id: id
                    }
                });
        }catch(e){
            vscode.postMessage({
                command: 'log_event',
                value: `###PREVIEWWWWWWWIDD Checking if onChipClickWithId error ${e}`
            });
        }
    }
    
</script>


<script>

    function handleInput(event) {
        try {
            const textarea = event.target;
            const lineHeight = 20;
            const maxLines = 15;
            const maxHeight = lineHeight * maxLines;
            
            // Reset height to measure content
            textarea.style.height = 'auto';
            
            const contentHeight = textarea.scrollHeight;
            const numberOfLines = Math.floor(contentHeight / lineHeight);

            if (numberOfLines <= maxLines) {
                textarea.style.height = Math.max(contentHeight, 72) + 'px';
                textarea.style.overflowY = 'hidden';
            } else {
                textarea.style.height = maxHeight + 'px';
                textarea.style.overflowY = 'auto';
            }

            // Handle slash commands
            const value = textarea.value;
            if (value.startsWith("/")) {
                const mainDiv = document.getElementById("slash-suggestion-popup");
                mainDiv.innerHTML = "";
                mainDiv.style.display = "flex";
                mainDiv.style.flexDirection = "column";
                options
                    .filter(option => option.name.includes(value.trim()))
                    .forEach(option => {
                        create_suggestion(option["name"], option["explanation"]);
                    });
            } else {
                const mainDiv = document.getElementById("slash-suggestion-popup");
                mainDiv.style.display = "none";
            }

        } catch (e) {
            console.log("###NEWWWWWINFO Error in handleInput", e)
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        const textarea = document.getElementById('input');
        if (textarea) {
            textarea.addEventListener('input', handleInput);
            
            // Add keydown event listener
            textarea.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    if (e.shiftKey) {
                        // Shift+Enter: Add new line
                        // Adjust height after adding new line
                        handleInput({ target: textarea });
                        e.preventDefault();
                        const start = textarea.selectionStart;
                        const end = textarea.selectionEnd;
                        const value = textarea.value;
                        textarea.value = value.substring(0, start) + '\n' + value.substring(end);
                        textarea.selectionStart = textarea.selectionEnd = start + 1;
                        textarea.scrollTo(0, textarea.scrollHeight);
                    } else {
                        // Enter only: Send message
                        e.preventDefault();
                        sendMessage();
                    }
                }
            });
            // Initial height setup
            handleInput({ target: textarea });
        }
    });

   
    vscode = acquireVsCodeApi();

    try{
       

        // Parse theme colors passed from the extension
        const themeColors = THEME_COLORS;

        vscode.postMessage({
            command: 'log_event',
            value: `Theme colors received: ${themeColors}`
        });

        // Enhanced function to apply theme colors
        function applyThemeColors() {
            const root = document.documentElement;
            
            // Core editor colors
            root.style.setProperty('--editor-background', themeColors['editor.background']);
            root.style.setProperty('--editor-foreground', themeColors['editor.foreground']);
            
            // Token colors for syntax highlighting
            root.style.setProperty('--token-string', themeColors['token.string'] || '#CE9178');
            root.style.setProperty('--token-variable', themeColors['token.variable'] || '#9CDCFE');
            root.style.setProperty('--token-class', themeColors['token.class'] || '#4EC9B0');
            root.style.setProperty('--token-keyword', themeColors['token.keyword'] || '#569CD6');
            
            // Button colors
            root.style.setProperty('--button-background', themeColors['button.background']);
            root.style.setProperty('--button-foreground', themeColors['button.foreground']);
            
            // Input colors
            root.style.setProperty('--input-background', themeColors['input.background']);

            var inputForeground = root.style.getPropertyValue('--input-foreground');
            var editorBackground = root.style.getPropertyValue('--editor-background');
            if(isLightColor(inputForeground)&&isLightColor(editorBackground)){
                root.style.setProperty('--input-foreground', '#9399B2');
            }else{
                root.style.setProperty('--input-foreground', themeColors['input.foreground']);
            }

            if(!isLightColor(inputForeground)&&!isLightColor(editorBackground)){
                root.style.setProperty('--input-foreground', '#9399B2');
            }else{
                root.style.setProperty('--input-foreground', themeColors['input.foreground']);
            }
            vscode.postMessage({
                command: 'log_event',
                value: `theme-colors: input foreground ${inputForeground} editor background ${editorBackground}`
            });
            // Panel colors
            root.style.setProperty('--panel-background', themeColors['panel.background']);

        }

        function isLightColor(hexColor){
            // Remove the # if present
            hexColor = hexColor.replace('#', '');
            
            // Convert hex to RGB
            const r = parseInt(hexColor.substr(0, 2), 16);
            const g = parseInt(hexColor.substr(2, 2), 16);
            const b = parseInt(hexColor.substr(4, 2), 16);
            
            // Calculate relative luminance using the formula
            // Luminance = (0.299 * R + 0.587 * G + 0.114 * B) / 255
            const luminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;
            
            // Consider the color light if luminance is greater than 0.5
            return luminance > 0.5;
        }

        applyThemeColors()
    }catch(e){
        vscode.postMessage({
            command: 'log_event',
            value: `Error acquiring vscode api: ${e}`
        });
    }

    var tier = REPLACE_THIS;
    var load_thread = LOAD_THREAD;
    var curCode = null;
    var initial = "FIRST_LETTER"
    var connecting = "CONNECTING"
    set_connecting(false)
    var attachments = []
    let lastHandledAtIndex = -1;
    let showDropdown=false;
   
    if (load_thread == "yes"){
        const overlay = document.getElementById("overlay");
        const spinner = document.getElementById("spinner");
        overlay.style.display = "flex"
        spinner.style.display = "flex"
    }

    const options = [ 
        {name: "/fix_code", explanation: "Fix the selected code"}, 
        {name: "/run_code", explanation: "Run the selected code"}, 
        {name: "/optimize_code", explanation: "Optimize the selected code"}, 
        {name: "/generate_unit_test", explanation: "Generate the selected code"},
        {name: "/generate_doc_string", explanation:"Explain the selected code"}]

    const names = ["/fix_code", "/run_code", "/fix_code", "/optimize_code", "/generate_unit_test", "/generate_doc_string"]
    var highLightedCode = ""
    function create_suggestions(){
        options.forEach(option=>{
            create_suggestion(option["name"], option["explanation"])
        });
    }

    function set_attachments(attachments, loading){
        var attachment_div = document.getElementById("attachment_div")
        var attachement_first_name = document.getElementById("attachement_first_name")

        attachment_div.style.display = "flex"
        var uploading = loading? "uploading" : "uploaded"
        if (attachments.length > 1){
            attachement_first_name.textContent = `${uploading} ${attachments[0]} and ${attachments.length-1}+ more files`
        }else{
            attachement_first_name.textContent = `${uploading} ${attachments[0]}`
        }       
        var attachment_loader_spinner = document.getElementById("attachemnt_spinner")
        if (loading){
            attachment_loader_spinner.style.display = "flex"
        }else{
            attachment_loader_spinner.style.display = "none"
        }
    }   

    function remove_attachments(){
        var attachment_div = document.getElementById("attachment_div")
        var attachement_first_name = document.getElementById("attachement_first_name")

        attachment_div.style.display = "none"
    }   

    function set_current_working_file(filename, indexing){
        
    }
    
    function openPickAttachmentModal(){
        vscode.postMessage({
            command: "add_attachments", 
            value: "add_attachments"
        })
    }

    function set_connecting(connecting){
       // reimplemt set connecting
    }

    function removePopUp(){
        const modalPopup= document.getElementById('pop-up-overlay');
        if(modalPopup){
            modalPopup.style.display='none';
        }
    }

    function create_suggestion(name, explanation){
        const div = document.createElement("div")
        div.className = "suggestoin-div"
        div.id = name
        const nameSpan = document.createElement("span")
        nameSpan.textContent = name
        const descriptionSpan = document.createElement("span")
        descriptionSpan.textContent = explanation
        descriptionSpan.style.color = "#5454C5"
        descriptionSpan.style.opacity = "0.7"
        descriptionSpan.style.fontWeight = "600"
        div.appendChild(nameSpan)
        div.appendChild(descriptionSpan)
        div.addEventListener("click", (e)=>{
            onClick("log_event", `value of highlighted code`)
            
            if (highLightedCode !=""&&highLightedCode!=undefined&&highLightedCode!=null){
                if (tier=="standard"){
                    addChat(div.id, div.id, true)
                }else{
                    if (name == "/fix_code"){
                        addChat(div.id, div.id, true)
                    }else{
                        onClick("show_add_card_modal", name)
                    }
                }
            }else{
                onClick("log_event", `No code highlighted!, please highlight the part of your code you wish to perform this action on`)
                onClick("show_error_message", `No code highlighted!, please highlight the part of your code you wish to perform this action on`)
            }
            
        })
        const mainDiv = document.getElementById("slash-suggestion-popup")
        mainDiv.appendChild(div)
    }


    const textarea = document.getElementById('input');
    const dropdown = document.getElementById("mention-dropdown");
    const mentions = ["John Doe", "Jane Smith", "Alice Johnson", "Bob Brown","Precious Balogun"];

   


    function countWords(str) {
        // Trim the string to remove leading and trailing whitespace
        // Split the string by spaces, filtering out empty strings that result from multiple spaces
        const words = str.trim().split(/\s+/).filter(word => word.length > 0);
        return words.length;
    }

    
    

    function goBackToMenu() {
        vscode.postMessage({
            command: "go_to_menu",
            value: ""
        })
    }

    function onClick(command, value) {
        if (tier ==="standard"){
            vscode.postMessage({
                command: command,
                value: value
            })
        }else{
            vscode.postMessage({
                command: "log_event", 
                value: `I was called with this command ${command}`
            })
            if (command !== "useCase"){

            }else{
                if (command === "useCase" && value === "GPT40_UPGRADE"){
                    vscode.postMessage({
                        command: command,
                        value: value
                    })
                    removePopUp()
                }else{
                    const modalPopup= document.getElementById('pop-up-overlay');
                    if(modalPopup){
                        modalPopup.style.display='flex';
                    }
                } 
            }   
        }
    }

    function addCode(needCofirmation,buttonObj) {
        let actual_complete_code= localStorage.getItem(buttonObj.dataset.uid);
        if (actual_complete_code==null||actual_complete_code==undefined){
            actual_complete_code="";
        }
        const inputField = document.getElementById("line-number-input");
        try {
            console.log("let's see the actual input value",actual_complete_code,buttonObj.dataset.uid);
            vscode.postMessage({
                command: "add_code_immediately",
                value: {
                    code: actual_complete_code,
                    line: inputField.value,
                    needs: needCofirmation
                }
            })
            localStorage.removeItem(buttonObj.dataset.uid);
            hideAddCodeModal();
        } catch (error) {
            vscode.postMessage({
                command: "log_event",
                value: error.message
            })
        }
    }

    function createFile(fileName,actual_code) {
        
        console.log("let's see the actual input value",actual_code);
        
        vscode.postMessage({
            command: "create_file_for_code",
            value: {
                code: actual_code,
                fileName: fileName
            }
        })
    }


    function hideAddCodeModal() {
        const modal = document.getElementById("addCodemodal");
        const overlay = document.getElementById("overlay");
        modal.style.display = "none";
        overlay.style.display = "none"
    }

    function sendMessage() {
        const textarea = document.getElementById("input");
        const input = textarea.value.trim();
        
        if (input) {
            hideAllPreviews(); // Hide all previews before sending
            addChat(input, "huuu");
            textarea.value = "";
            handleInput({ target: textarea }); // Resize textarea after clearing
        }
    }


    function showAddCodeModal(code) {
        const modal = document.getElementById("addCodemodal");
        const overlay = document.getElementById("overlay");
        const modalBtnObj=document.getElementById('modal-button-id');
        const modalBtnTwoObj=document.getElementById('modal-button-two-id');
        const uid=generateRandomString(16);
        modalBtnObj.dataset.uid = uid;
        modalBtnTwoObj.dataset.uid = uid;
        console.log("why now",uid,code);
        localStorage.setItem(uid,code);
        modal.style.display = "flex";
        overlay.style.display = "flex"

    }

    function elementExists(id) {
        return document.getElementById(id) !== null;
    }


    function extractFileSubstring(inputString) {
        let extractedSubstring = '';
        let newString = inputString;
    
        // Check if the string starts with "##FILE:"
        if (inputString.startsWith('##FILE:')) {
            // Find the end index of the substring, which is the position of the next ":"
            const endIndex = inputString.indexOf(':', 7); // start searching after "##FILE:"
           
    
            // Extract the substring and remove it from the original string
            if(endIndex===-1){
                extractedSubstring = '';
                newString=inputString.slice(6);
                return { extractedSubstring, newString }
            }
            extractedSubstring = inputString.substring(0, endIndex + 1);
            extractedSubstring=extractedSubstring.replace(/^##FILE:|:$/g, '');
            newString = inputString.slice(endIndex + 1).trim();
        }

        return { extractedSubstring, newString };
    }

    function extractFileName(inputString) {
        if (inputString.startsWith('##FILE:')) {
            // Find the end index of the substring, which is the position of the next ":"
            const endIndex = inputString.indexOf(':', 7); // start searching after "##FILE:"
            return inputString.substring(7, endIndex);
        }
        return '';
    }

    function ParseMessage(text, id){
        const renderer = new marked.Renderer();
        renderer.code = (code, language) => {
            let langBlock = "language-" + code.lang
            const escapedCode = code.text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
            let result = extractFileSubstring(escapedCode);
            let name = extractFileName(escapedCode);
            
            // Check if filename is empty
            if (!name) {
                name = 'info.txt';
                return `<div class="code-block">
                    <div class="code-toolbarr">
                        <div class="language-name">
                            <span class="file-icon file-icon-light">${getFileIcon(name)}</span>
                            ${name}
                        </div>
                        <div class="toolbar-actions">
                            <button onclick="copyToClipboard(this,'copy')" title="Copy">
                                <i class="fas fa-copy"></i>
                            </button>
                            <button onclick="askAboutCode(this)" title="Ask">
                                <i class="fas fa-external-link-alt"></i>
                                <span>Ask</span>
                            </button>
                        </div>
                    </div>
                    <pre class="scroll-container"><code class="${langBlock}">${result.newString}</code></pre>
                    <div class="spinner-container"  id="code-spinner" >
                        <span class="file-name">Generating Large Code Please wait...</span>
                    </div>
                </div>
                `;
            }
            
            // Original implementation for files with names
            return `
            <div class="code-block">
                <div class="code-toolbarr">
                    <div class="language-name">
                        <span class="file-icon file-icon-light">${getFileIcon(name)}</span>
                        ${name}
                    </div>
                    <div class="toolbar-actions">
                        <button onclick="copyToClipboard(this,'copy')" title="Copy">
                            <i class="fas fa-copy"></i>
                        </button>
                        <button onclick="copyToClipboard(this,'add')" title="Apply">
                            <i class="fas fa-play"></i>
                            <span>Apply</span>
                        </button>
                    </div>
                </div>
                <pre class="scroll-container"><code class="${langBlock}">${result.newString}</code></pre>
                <div class="spinner-container" id="code-spinner" style="display: none;">
                    <span class="file-name">Generating Large Codebase, you can view this code after it's done, Please wait...</span>
                </div>
            </div>
            `;
        };
        // Set options for marked.js with custom renderer
        marked.setOptions({
            renderer: renderer,
            gfm: true,             // Use GitHub-flavored Markdown (optional)
            breaks: true,          // Convert line breaks into <br>
            smartLists: true,      // Use smart lists
            smartypants: false,    // Do not convert quotes to smart quotes
            sanitize: false,       // Allow HTML tags
            langPrefix: ''         // Prevent marked.js from adding its own lang class
        });
        const htmlContent = marked.parse(text);
        return htmlContent;
    }

    // Add function to handle asking about code
    function askAboutCode(button) {
        const codeBlock = button.closest('.code-block');
        const codeElement = codeBlock.querySelector('pre code');
        const code = codeElement.textContent;
        
        const prompt = `Can you explain this code:\n${code}`;
        const ids = addChat(prompt, "", false);
        OnlySendMessage(prompt, ids);
    }

    window.addEventListener('message', event => {
        console.log("Received message:", event.data);
        const message = event.data;
        switch (message.command) {


            case "set_file_attachments":
                attachment_info = message.value 
                attachments = attachment_info["files"]
                set_attachments(attachment_info["files"], attachment_info["loading"])
                break

            case "update_filename":
                //updateFileContext(message.value)
                break
            
            case "update_file_indicator":
                //updateFileIndicator(message.value.replace(".git", ""))
                break

            case "update_hightligted_code":
                highLightedCode = message.value
                break
            case "set_working_file":
                set_current_working_file(message.value["filename"], message.value["indexing"])
                break
            case "onNetworkChanged":
                const connected = message.value;
                if (!connected) {
                    // Hide generating text
                    try{
                        const generatingTexts = document.querySelectorAll('.generating-text');
                        generatingTexts.forEach(text => text.style.display = 'none');
                    
                    
                    // Show connection error
                    const elements = document.querySelectorAll('.dynamic-input-wrapper');
                    const lastUserDiv = elements[elements.length - 1];
                  
                    if (lastUserDiv) {
                        let errorDiv = lastUserDiv.querySelector('.connection-error');
                        if (!errorDiv) {
                            vscode.postMessage({
                                command: "log_event",
                                value: "No last user div foundsssss"
                            })
                            errorDiv = document.createElement('div');
                            errorDiv.className = 'connection-error';
                            errorDiv.innerHTML = `
                            <div style="display:flex; flex-direction:column; width:100%">
                                <div style="display: flex; align-items: center; border: 1px solid #F5C2C7; border-radius: 4px; padding: 8px 12px; margin: 8px 0;">
                                    <div style="display: flex; align-items: center; flex: 1;">
                                        <i class="fas fa-exclamation-triangle" style="color: #842029; margin-right: 8px;"></i>
                                        <span class="file-name" style="color: #ffffff">Connection failed.</span>
                                    </div>
                                    <button onclick="retryConnection(this)" class="file-name" style="background: none; border: none; color: #ffffff; cursor: pointer; display: flex; align-items: center; padding: 4px 8px; font-size: 14px;">
                                        <i class="fas fa-redo" style="margin-right: 4px;"></i>
                                        Try again
                                    </button>
                                </div>
                                <span class="file-name">If the problem persists, Please check your internet connection or VPN, or email us at ope@trysixth.com</span>
                            </div>
                            `;
                            lastUserDiv.appendChild(errorDiv);
                        }
                        errorDiv.style.display = 'block';
                    }
                    else{
                        vscode.postMessage({
                            command: "log_event",
                            value: "No last user div not foundsssss"
                        })
                    }
                    }catch(e){
                        vscode.postMessage({
                            command: "log_event", 
                            value:`No last user div not foundsssss Error is ${e}`
                        })
                    }
                   
                }
                break;
            case 'retry_connection':
                retryConnection(message.value);
                break;
            case "fill_history":
                try{
                    var response = message.value.reverse()
                    
                   
                    for (var item of response){
                        //console.log(item["value"],"lemme see the item");
                        vscode.postMessage({
                                command:"log_event", 
                                value: `Fill history was triggereed!!!! ${item["value"]}`
                            })
                            
                            addChatOnly(item)
                    }
                    const overlay = document.getElementById("overlay");
                    const spinner = document.getElementById("spinner");
                    overlay.style.display = "none"
                    spinner.style.display = "none"

                    }catch(e){
                        vscode.postMessage({
                            command:"log_event", 
                            value: `Dynamic adding of chat error ${e}`
                        })
                    }
                break
            case 'fill_text':
                try {
                    const visibleError = Array.from(document.getElementsByClassName('connection-error'))
                        .find(el => el.style.display !== 'none');
                    if (visibleError) {
                        visibleError.remove();
                    }

                    data = message.value;
                    const question_id = data["question_id"];
                    const botDiv = document.getElementById(`bot ${data["id"]}`);
                    var globalID = data["id"];
                    
                    // Hide the generating text when content starts arriving
                    const generatingText = botDiv.querySelector('.generating-text');
                    if (generatingText) {
                        generatingText.style.display = 'none';
                    }
                    
                    const textbox = document.getElementById(data["id"]);
                    try {
                        textbox.remove();
                    } catch(error) {}
                    
                    if(data["require_reindex"]==true){
                        vscode.postMessage({
                        command: "require_reindex"
                    })
                    }

                    if(data["flag"]=="SUCCESS"){
                        let aiMessageDiv='';
                        if(localStorage.getItem(question_id)===null){
                            aiMessageDiv = document.createElement("div");
                            aiMessageDiv.className="ai-message-box";
                            aiMessageDiv.id="ai-reply-"+question_id;
                            botDiv.appendChild(aiMessageDiv);
                            localStorage.setItem(question_id,question_id);
                        }else{
                            aiMessageDiv = document.getElementById("ai-reply-"+question_id);
                        }
                        const parsed=ParseMessage(data.message.value, aiMessageDiv.id);
                        aiMessageDiv.innerHTML=parsed;
                        Prism.highlightAll();
                        aiMessageDiv.scrollIntoView({ behavior: 'smooth', block: 'end' });
                    }
                    else if (data["flag"]=="UPGRADE"){
                        var fileNameDiv = document.createElement("div")
                        fileNameDiv.style.width = "100%"
                        fileNameDiv.style.display = "flex"
                        fileNameDiv.style.justifyContent = "end"
                        fileNameDiv.style.marginTop = "12px"
                        fileNameDiv.style.marginBottom = "12px"
                        var UpgradeButtton = document.createElement("code")
                        UpgradeButtton.style.paddingLeft = "8px"
                        UpgradeButtton.style.paddingRight = "8px"
                        UpgradeButtton.style.paddingTop = "4px"
                        UpgradeButtton.style.paddingBottom = "4px"
                        UpgradeButtton.textContent = "Click here to upgrade your account ✨"
                        UpgradeButtton.style.color = "white";
                        UpgradeButtton.style.marginRight = "8px"

                        UpgradeButtton.addEventListener('mouseenter', function () {
                            UpgradeButtton.classList.add('click-cursor');
                        });

                        UpgradeButtton.addEventListener('mouseleave', function () {
                            UpgradeButtton.classList.remove('click-cursor');
                        });


                        UpgradeButtton.addEventListener('click', function () {
                            showUploadFileModal('JIRA') 
                        });

                        fileNameDiv.appendChild(UpgradeButtton)
                        botDiv.appendChild(fileNameDiv)
                    }
                } catch (error) {
                    vscode.postMessage({
                        command: "log_event",
                        value: `From Fill text ${error.stack}`
                    })
                    vscode.postMessage({
                        command: "log_event",
                        value: `From Fill text ${error.message}`
                    })
                }

                break;
            case 'error_fix_chat':
                value = message.value;
                const prompt = value["message"]["value"];
                const contextChip = value["message"]["context_chip"];
                const errorCode = value["message"]["error_code"];
                const fileRange = value["message"]["file_range"];
                var fileName = ""
                if (fileRange.start != fileRange.end){
                    fileName = fileRange.file + " " + fileRange.start + "-" + fileRange.end;
                }else{
                    fileName = fileRange.file + " " + fileRange.start;
                }
                allAddedFiles.push(fileName);
                addChat(prompt, contextChip, true);
                break
            case 'update_tier':
                tier = "standard";

                try{
                    removePopUp()
                   
                }catch(error){
                    vscode.postMessage({
                        command: "log_event",
                        value: error.message
                    })
                }

                break;
            case 'DETECT_VULNERABILTY':
                try {
                    data = message.value;
                    const ids = addChat(data["display_question"], "", false)
                    vscode.postMessage({
                        command: "chat_with_user", value: {
                            "id": ids,
                            "user_prompt": data["actual_prompt"]
                        }
                    });
                }
                catch (error) {
                    vscode.postMessage({
                        command: "log_event",
                        value: error.message
                    })
                }
                break
            case 'EXPLAIN_CODE':
                try {
                    data = message.value;
                    const ids = addChat(data["display_question"], "", false)
                    vscode.postMessage({
                        command: "chat_with_user", value: {
                            "id": ids,
                            "user_prompt": data["actual_prompt"]
                        }
                    });
                }
                catch (error) {
                    vscode.postMessage({
                        command: "log_event",
                        value: error.message
                    })
                }
                break
            case 'OPTIMIZE_CODE':
                try {
                    data = message.value;
                    const ids = addChat(data["display_question"], "", false)
                    vscode.postMessage({
                        command: "chat_with_user", value: {
                            "id": ids,
                            "user_prompt": data["actual_prompt"]
                        }
                    });
                }
                catch (error) {
                    vscode.postMessage({
                        command: "log_event",
                        value: error.message
                    })
                }
                break

            case 'GENERATE_UNIT_TEST':
                try {
                    data = message.value;
                    const ids = addChat(data["display_question"], "", false)
                    vscode.postMessage({
                        command: "chat_with_user", value: {
                            "id": ids,
                            "user_prompt": data["actual_prompt"]
                        }
                    });
                }
                catch (error) {
                    vscode.postMessage({
                        command: "log_event",
                        value: error.message
                    })
                }
                break

            case 'GENERATE_DOC_STRING':
                try {
                    data = message.value;
                    const ids = addChat(data["display_question"], "", false)
                    vscode.postMessage({
                        command: "chat_with_user", value: {
                            "id": ids,
                            "user_prompt": data["actual_prompt"]
                        }
                    });
                }
                catch (error) {
                    vscode.postMessage({
                        command: "log_event",
                        value: error.message
                    })
                }
                break

            case 'hideConnection':
            
                try{
                    

                }catch (error) {
                    //console.log("hey wtf??");
                    vscode.postMessage({
                        command: "log_event",
                        value: error.message
                    })
                }
                break

            case 'CONTEXT_LIST':
                const context= message.value;
                const keys = Object.keys(context).filter(key => message.value[key]?.DONE === true);
                const selectedContext=localStorage.getItem('context');
                if (keys.length > 0) {
                    dropdown.innerHTML = keys
                        .map(key => {
                            // Check if the key matches the selected context
                            const isSelected = key.trim() === selectedContext.trim();
                            console.log("cached context answer",selectedContext,key,isSelected);
                            // Add the span if the key matches
                            return `<div class="mention-item">
                                        ${key}
                                        ${isSelected ? '<span class="mention-item-span"><i class="fas fa-check"></i></span>' : ''}
                                    </div>`;
                        })
                        .join("");

                    dropdown.style.display = "block";
                } else {
                    dropdown.style.display = "none";
                }

            
        }

    });




    // Handle dropdown item clicks
    dropdown.addEventListener("click", (event) => {
            if (event.target.classList.contains("mention-item")) {
                const mention = event.target.textContent;
                const value = textarea.value;
                const atIndex = value.lastIndexOf("@");
                //textarea.value = value.slice(0, atIndex) + `@${mention} `;
                textarea.value = textarea.value.replace(`@`, '');
                dropdown.style.display = "none";

                // Update the lastHandledAtIndex to ignore this '@'
                //lastHandledAtIndex = -1; // Reset since dropdown is cleared
                showDropdown=false;
                vscode.postMessage({command:'change_vector_store',value:mention});
                localStorage.setItem('context',mention);
                
            }
    });

    

    document.addEventListener("DOMContentLoaded", () => {
        const inputField = document.getElementById("input");
        inputField.addEventListener("keydown", (e) => {
            if (e.code === "Enter") {
                if (e.shiftKey) {
                    // Insert a new line in the input field
                    const cursorPos = inputField.selectionStart;
                    const textBefore = inputField.value.substring(0, cursorPos);
                    const textAfter = inputField.value.substring(cursorPos);
                    inputField.value = `${textBefore}\n${textAfter}`;
                    inputField.selectionStart = inputField.selectionEnd = cursorPos + 1;
                } else {

                   
                    let input = inputField.value;

                    if (tier === "standard"){
                        // inputField.value = "";
                        // inputField.setAttribute('disabled', 'disabled');
                        // inputField.classList.add("skeleton-loading");
                        // output(input);
                        // progressCircle.style.borderColor = `rgba(84, 84, 197, 1)`;
                    }else{
                        
                    }
                    
                }
            }
        });

    });

    function findCommentNode(element) {
        // Iterate through child nodes of the element
        for (let i = 0; i < element.childNodes.length; i++) {
            const node = element.childNodes[i];
            // Check if the node is a comment node
            if (node.nodeType === Node.COMMENT_NODE) {
                return node; // Return the comment node
            }
        }
        return ""; // Return null if no comment node found
    }

    function output(input) {
        // Remove this function as it's no longer needed
    }

    function showUploadFileModal(feature) {
        if (tier === "standard" && feature === "JIRA") {
            vscode.postMessage({
                command: "showInformationModal",
                value: "Go ahead and ask chatGPT4 a question about your code!, debug your code or even help you run it 😁"
            })
        } else {
            vscode.postMessage({
                command: "showUploadFileModal",
                value: feature
            })
        }
    }

    function selectFileContext(){
        const dropup = document.getElementById('context-dropup');
        const previewDropup = document.getElementById('code-preview-dropup');
        const searchInput = document.getElementById('file-search');
        previewDropup.style.display = 'none';
        if (dropup.style.display === 'none') {
           
            dropup.style.display = 'block';
            searchInput.value = ''; // Clear search input
            searchInput.focus(); // Focus the search input
        } else {
            dropup.style.display = 'none';
        }
    }

    function generateRandomString(length) {
        var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
        var result = '';
        for (var i = 0; i < length; i++) {
            result += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return result;
    }

    function generateUniqueRandomString(length) {
        var timestamp = new Date().getTime().toString(36);
        var randomString = generateRandomString(length - timestamp.length);
        return timestamp + randomString;
    }

    function copyToClipboard(button,task) {
                        // Find the closest code block and select the <code> element within it
        const codeBlock = button.closest('.code-block');
        const codeElement = codeBlock.querySelector('pre code');
        
    
        // Copy the code content to the clipboard
        if (navigator.clipboard) {
            if(task==="copy"){
                navigator.clipboard.writeText(codeElement.textContent)
                .then(() => {
                    // Change button text to indicate success
                    button.innerHTML = '<i class="fas fa-check"></i> &nbsp; Copied!';
                    setTimeout(() => {
                        button.innerHTML = '<i class="fas fa-copy"></i>';
                    }, 2000); // Reset the button text after 2 seconds
                })
                .catch((err) => {
                    console.error('Failed to copy text: ', err);
                });
            }else if(task==="create"){
                createFile(button.dataset.filename,codeElement.textContent);
            }else if (task==="add"){
                //console.log("called copy clipboard",codeElement,codeElement.textContent);
                showAddCodeModal(codeElement.textContent);
            }else{
                navigator.clipboard.writeText(codeElement.textContent)
                .then(() => {
                    // Change button text to indicate success
                    button.innerHTML = '<i class="fas fa-check"></i> &nbsp; Copied!';
                    setTimeout(() => {
                        button.innerHTML = '<i class="fas fa-copy"></i>';
                    }, 2000); // Reset the button text after 2 seconds
                })
                .catch((err) => {
                    console.error('Failed to copy text: ', err);
                });
            }
            
        } else {
            // Fallback for browsers without navigator.clipboard API
            const textarea = document.createElement('textarea');
            textarea.value = codeElement.textContent;
            document.body.appendChild(textarea);
            textarea.select();
            try {

                if(task==="copy"){
                    document.execCommand('copy');
                    button.innerHTML = '<i class="fas fa-check"></i> &nbsp; Copied!';
                    setTimeout(() => {
                        button.innerHTML = '<i class="fas fa-copy"></i>';
                    }, 2000);
                }else if(task==="create"){
                createFile(button.dataset.filename,codeElement.textContent);
            }else if (task==="add"){
                //console.log("called copy clipboard",codeElement,codeElement.textContent);
                showAddCodeModal(codeElement.textContent);
            }else{
                document.execCommand('copy');
                button.innerHTML = '<i class="fas fa-check"></i> &nbsp; Copied!';
                setTimeout(() => {
                        button.innerHTML = '<i class="fas fa-copy"></i>';
                    }, 2000);
            }

            } catch (err) {
                console.error('Fallback: Could not copy text', err);
            } 
            document.body.removeChild(textarea);
        }
    }


    function addChatOnly(message){
        const messagesContainer = document.getElementById("messages");
        if (message["role"] == "user"){

            let userDiv = document.createElement("div");
            userDiv.id = "user";
            userDiv.className = "user_response";
            userDiv.style.display = "flex"
            userDiv.style.flexDirection = "row"
            userDiv.innerHTML = `<div class="user_avatar"> <span class="user_avatar_text" >${initial}</span> </div><span style="font-size:11px;color:#FDE4FF;margin-top:5px;">${message["value"]["value"]}</span>`;
            
            messagesContainer.appendChild(userDiv);
        }else{
            let botDiv = document.createElement("div");
            botDiv.style.display = "flex";
            botDiv.style.flexDirection = "column";
            botDiv.style.alignItems = "flex-end";
            botDiv.className = "bot response";
            if (attachments.length >0){
                botDiv.innerHTML = `<div style="margin-top:8px; display: flex; flex-direction: row; align-items:end; display:none" id="attachment_div">
                    <div class="attachment_file_container">
                        <?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 30 30" width="70px" height="70px" style="fill: #FDE4FF;  margin-right:0px">    <path d="M24.707,8.793l-6.5-6.5C18.019,2.105,17.765,2,17.5,2H7C5.895,2,5,2.895,5,4v22c0,1.105,0.895,2,2,2h16c1.105,0,2-0.895,2-2 V9.5C25,9.235,24.895,8.981,24.707,8.793z M18,10c-0.552,0-1-0.448-1-1V3.904L23.096,10H18z"/></svg>
                    </div>
                    <?xml version="1.0"?><svg xmlns="http://www.w3.org/2000/svg" id="remove_attachement" onclick="remove_attachments()" viewBox="0 0 30 30" width="14px" height="14px" style="fill: #FDE4FF; cursor:pointer; margin-bottom:52px; margin-left:0px">    <path d="M15,3C8.373,3,3,8.373,3,15c0,6.627,5.373,12,12,12s12-5.373,12-12C27,8.373,21.627,3,15,3z M16.414,15 c0,0,3.139,3.139,3.293,3.293c0.391,0.391,0.391,1.024,0,1.414c-0.391,0.391-1.024,0.391-1.414,0C18.139,19.554,15,16.414,15,16.414 s-3.139,3.139-3.293,3.293c-0.391,0.391-1.024,0.391-1.414,0c-0.391-0.391-0.391-1.024,0-1.414C10.446,18.139,13.586,15,13.586,15 s-3.139-3.139-3.293-3.293c-0.391-0.391-0.391-1.024,0-1.414c0.391-0.391,1.024-0.391,1.414,0C11.861,10.446,15,13.586,15,13.586 s3.139-3.139,3.293-3.293c0.391-0.391,1.024-0.391,1.414,0c0.391,0.391,0.391,1.024,0,1.414C19.554,11.861,16.414,15,16.414,15z"/></svg>
                    <p style="color: #FDE4FF; margin: 0px; font-size: 12px;" id="attachement_first_name">uploaded /chatgpt/main.py</p>
                </div>`
            }

            messagesContainer.appendChild(botDiv);
            botDiv.style.marginBottom = "12px";
            let aiMessageDiv='';
            aiMessageDiv = document.createElement("div");
            aiMessageDiv.className="ai-message-box";
            aiMessageDiv.id="ai-reply-"+generateRandomString(8);
            botDiv.appendChild(aiMessageDiv);
            //localStorage.setItem(question_id,question_id);
            const parsed=ParseMessage(message.value.value, aiMessageDiv.id);
            aiMessageDiv.innerHTML=parsed;
            Prism.highlightAll();
            aiMessageDiv.scrollIntoView({ behavior: 'smooth', block: 'end' });
            
            messagesContainer.scrollTop = messagesContainer.scrollHeight - messagesContainer.clientHeight;
        }
        
    }

    function checkAndRemoveSubstring(str, substring) {
        if(substring===null||substring===undefined){
            return str;
        }

        if (str.includes(substring)) {
            return str.replace(substring, ""); // Remove the substring
        }

        return str; // Return the original string if substring doesn't exist
    }


    function updateContextChipsWithId(id, files, addedFiles) {
        vscode.postMessage({
                command: "log_event",
                value: `###AREYOUCALLEDINFO updateContextChips LOGGERRR `,
            });
       
        try{
            const contextSection = document.getElementById('context-section-'+id);
            const addContextChip = document.querySelector('#context-chip-'+id);
            var chipsContainer = document.getElementById('context-chips-'+id);

            vscode.postMessage({
                command: "log_event",
                value: `###INFO updateContextChips LOGGERRR chipsContainer is ${chipsContainer} contextSection is ${contextSection} addContextChip is ${addContextChip} `,
            });
                
            // Create chips container if it doesn't exist
            if (!chipsContainer) {
                const newChipsContainer = document.createElement('div');
                newChipsContainer.id = 'context-chips-'+id;
                newChipsContainer.className = 'dynamic-context-chips'
                contextSection.appendChild(newChipsContainer);
            }
            
            // Get the container (whether existing or newly created)
            const container = document.getElementById('context-chips-'+id);
            container.innerHTML = '';
            
            if (files.length > 0) {
                // Hide the "Add context" text but keep the + button
                const contextName = addContextChip.querySelector('#context-name-'+id);
                if (contextName) {
                    contextName.style.display = 'none';
                }
                
                // Add chips for each file
                addedFiles.forEach(fsss => {
                    vscode.postMessage({
                        command: "log_event",
                        value: `###LOGGESSSSRINFO updateContextChips fsss is ${fsss}`,
                    });
                    const fileName = fsss.split('/').pop();
                    const chip = document.createElement('div');
                    chip.className = 'dynamic-context-chip';
                    chip.innerHTML = `
                        <span class="file-icon">${getFileIcon(fileName)}</span>
                        <span class="file-name">${fileName}</span>
                        <button class="remove-button" onclick="removeFileContext('${fsss}', event)">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                   
                    chip.onclick = () => onChipClickWithId(id,fsss);
                    vscode.postMessage({
                        command: "log_event",
                        value: `###LOGGESSSSRINFO CHIPONCLICKER updateContextChips fsss is ${fsss}`,
                    });
                    container.appendChild(chip);
                    container.style.display = 'flex';
                    contextSection.appendChild(container);

                    vscode.postMessage({
                        command: "log_event",
                        value: `###INFO updateContextChips APPEND CHULKLLEEE ${container} contextSection is ${contextSection}`,
                    });
                });
            } else {
                vscode.postMessage({
                command: "log_event",
                value: `###INFO updateContextChips empty path ${addedFiles}`,
            });
                // Show the "Add context" text
                const contextName = addContextChip.querySelector('.context-name-'+id);
                if (contextName) {
                    contextName.style.display = 'block';
                }
                container.style.display = 'none';
            }
        }catch(e){
            vscode.postMessage({
                command: "log_event",
                value: `###INFO Error in updateContextChips ${e}`,
            });
        }
        
    }



    function createUserDiv(input, id, addedFiles){
        const innerHtml = `
                <div class="textarea-container">
                    <!-- Add the context section here -->
                    <div class="context-section" id="context-section-${id}">
                        <div class="dynamic-code-preview-dropup" id="code-preview-dropup-${id}" style="display: none;">
                            <div class="code-preview-actions">
                                <button class="preview-action-btn" onclick="openFileInWorkspace()">
                                    <i class="fas fa-external-link-alt"></i><span class="preview-action-btn-text">Open</span>
                                </button>
                                <button class="preview-action-btn" onclick="collapseCodePreview()">
                                    <i class="fas fa-chevron-up"></i> <span class="preview-action-btn-text">Collapse</span>
                                </button>
                                <button class="preview-action-btn" onclick="removeFileContext(currentPreviewFile, event)">
                                    <i class="fas fa-times"></i><span class="preview-action-btn-text">Remove</span>
                                </button>
                            </div>
                            <pre class="dynamic-code-preview-content"><code id="preview-code-${id}"></code></pre>
                        </div>
                        <div class="dynamic-context-chip" id="context-chip-${id}">
                            <div class="context-label-${id}">+</div>
                            <div class="context-name-${id}">Add context</div>
                           
                        </div>
                        <!-- Add the dropup menu -->
                        <div class="dynamic-context-dropup" id="context-dropup-${id}" style="display: none;">
                            <div class="search-container">
                                <input type="text" 
                                       class="search-input" 
                                       id="file-search-${id}" 
                                       placeholder="Search files by name">
                            </div>
                            <div class="dropup-section">
                                <div class="section-header">ADDED</div>
                                <div class="section-content" id="added-files-${id}">
                                    <!-- Added files will be listed here -->
                                </div>
                            </div>
                            <div class="dropup-section">
                                <div class="section-header">AVAILABLE</div>
                                <div class="section-content" id="available-files-${id}">
                                    <!-- Available files will be listed here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Existing textarea and send button -->
                    <textarea 
                        id="input-${id}"
                        placeholder="Type '/' for commands, '@' for links you uploaded or simply type."
                        rows="1"
                    ></textarea>
                    <button class="send-button" id="send-button-${id}">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                        </svg>
                    </button>
                </div>
        `
        return innerHtml;
    }

    function OnlySendMessage(input, ids){
        hideAllPreviews(); // Hide all previews before sending
        vscode.postMessage({
            command: "chat_with_user", 
            value: {
                "id": ids,
                "user_prompt": input
            }
        });
    }

    function CreateSeparateListener(mainDiv, id, files=[], input="") {
        const textarea = mainDiv.querySelector('#input-'+id);
        textarea.value = input;
        const sendButton = mainDiv.querySelector("#send-button-"+id);
        sendButton.onclick = () => OnlySendMessage(textarea.value, id);
        const contextChip = mainDiv.querySelector("#context-chip-"+id);
        contextChip.onclick = () => selectFileContextWithId(id);
        const fileSearch = mainDiv.querySelector("#file-search-"+id);
        fileSearch.oninput = () => filterFilesWithId(fileSearch.value, id);
        
        
        if (textarea) {
            // Add input handler for dynamic height adjustment
            const adjustHeight = (textarea) => {
                const lineHeight = 20;
                const maxLines = 15;
                const maxHeight = lineHeight * maxLines;
                
                textarea.style.height = 'auto';
                const contentHeight = textarea.scrollHeight;
                const numberOfLines = Math.floor(contentHeight / lineHeight);

                if (numberOfLines <= maxLines) {
                    textarea.style.height = Math.max(contentHeight, 72) + 'px';
                    textarea.style.overflowY = 'hidden';
                } else {
                    textarea.style.height = maxHeight + 'px';
                    textarea.style.overflowY = 'auto';
                }
            };

            textarea.addEventListener('input', (e) => {
                handleInput(textarea);
                
                // Handle slash commands
                const value = textarea.value;
                if (value.startsWith("/")) {
                    const mainDiv = document.getElementById("slash-suggestion-popup");
                    mainDiv.innerHTML = "";
                    mainDiv.style.display = "flex";
                    mainDiv.style.flexDirection = "column";
                    options
                        .filter(option => option.name.includes(value.trim()))
                        .forEach(option => {
                            create_suggestion(option["name"], option["explanation"]);
                        });
                } else {
                    const mainDiv = document.getElementById("slash-suggestion-popup");
                    mainDiv.style.display = "none";
                }
            });

            // Trigger initial height adjustment for prefilled value
            adjustHeight(textarea);
            updateContextChipsForId(mainDiv, allAddedFiles, id);
        }        
    }

    function updateContextChipsForId(mainDiv, files, id) {
        try{
            const contextSection = mainDiv.querySelector('#context-section-'+id);
            const addContextChip = mainDiv.querySelector('#context-chip-'+id);
            var chipsContainer = mainDiv.querySelector('#context-chips-'+id);
            
            // Create chips container if it doesn't exist
            if (!chipsContainer) {
                const newChipsContainer = document.createElement('div');
                newChipsContainer.id = 'context-chips-'+id;
                newChipsContainer.className = 'context-chips-'+id;
                contextSection.appendChild(newChipsContainer);
            }
            
            // Get the container (whether existing or newly created)
            const container = mainDiv.querySelector('#context-chips-'+id);
            container.innerHTML = '';
            
            if (files.length > 0) {
                // Hide the "Add context" text but keep the + button
                const contextName = addContextChip.querySelector('#context-name-'+id);
                if (contextName) {
                    contextName.style.display = 'none';
                }
                
                // Add chips for each file
                files.forEach(fsss => {
                    vscode.postMessage({
                        command: "log_event",
                        value: `###INFO updateContextChips fsss is ${fsss}`,
                    });
                    const fileName = fsss.split('/').pop();
                    const chip = document.createElement('div');
                    chip.className = 'context-chip';
                    chip.id = 'context-chip-'+id;   
                    chip.innerHTML = `
                        <span class="file-icon">${getFileIcon(fileName)}</span>
                        <span class="file-name">${fileName}</span>
                        <button class="remove-button" onclick="removeFileContext('${fsss}', event)">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                   
                    chip.onclick = () => onChipClick(fsss);
                    container.appendChild(chip);
                    container.style.display = 'flex';
                    contextSection.appendChild(container);

                    vscode.postMessage({
                        command: "log_event",
                        value: `###INFO updateContextChips APPEND CHULKLLEEE ${container} contextSection is ${contextSection}`,
                    });
                });
            } else {
                vscode.postMessage({
                    command: "log_event",
                    value: `###INFO updateContextChips empty path ${allAddedFiles}`,
                });
                // Show the "Add context" text
                const contextName = addContextChip.querySelector('#context-name');
                if (contextName) {
                    contextName.style.display = 'block';
                }
                container.style.display = 'none';
            }
    }catch(e){
        vscode.postMessage({
            command: "log_event",
            value: `###INFO Error in updateContextChips ${e}`,
        });
    }
    
}


    function addChat(input, product, sendWithAddChatInput = true) {
        const messagesContainer = document.getElementById("messages");
    
        var ids = generateUniqueRandomString(10);
        curMessageId=ids;
        let userDiv = document.createElement("div");
        userDiv.id = "user-"+ids;
        userDiv.className = "dynamic-input-wrapper";
        userDiv.style.display = "flex";

        userDiv.innerHTML = createUserDiv(input, ids, allAddedFiles);
        CreateSeparateListener(userDiv, ids, allAddedFiles, input);
        

        vscode.postMessage({
                command: "log_event",
                value: `###INFOINNERHTML Checking if addChat 2 ${userDiv.innerHTML}`
            })

      
        
        
        messagesContainer.appendChild(userDiv);

        var preElement = document.createElement('pre');
        let botDiv = document.createElement("div");
        botDiv.style.marginBottom = "12px";
        let botText = document.createElement("code");
        
        // Replace "Typing..." with generating indicator
        const generatingSpan = document.createElement('span');
        generatingSpan.className = 'generating-text';
        generatingSpan.textContent = 'Generating';
        
        botDiv.style.display = "flex";
        botDiv.style.flexDirection = "column";
        botDiv.style.alignItems = "flex-end";
        botDiv.classList.add('language-python');
        preElement.appendChild(botText);
        botText.id = ids;
        botDiv.id = "bot " + ids;
        botDiv.className = "bot response";
        botDiv.appendChild(generatingSpan);
        botDiv.appendChild(preElement);

        vscode.postMessage({
                command: "log_event",
                value: "###INFO Checking if addChat 3"
            })
    
    

        messagesContainer.appendChild(botDiv);
        // Keep messages at most recent
        messagesContainer.scrollTop = messagesContainer.scrollHeight - messagesContainer.clientHeight;

        // Fake delay to seem "real"
        if (sendWithAddChatInput) {
            if (!names.includes(input.trim())){
                
                vscode.postMessage({
                    command: "chat_with_user", value: {
                        "id": ids,
                        "user_prompt": input
                    }
                })
            }else{
                textarea.value = "";
                vscode.postMessage({
                    command: "special_chat_with_user", value: {
                        "id": ids,
                        "user_prompt": input
                    }
                })
            }
        } else {
            return ids
        }
    }

    function fillTemplate(template, value, placeholder) {
        return template.replace(placeholder, value);
    }

    // Add this to your existing JavaScript
    document.addEventListener('DOMContentLoaded', () => {
        const contextClose = document.querySelector('.context-close');
        if (contextClose) {
            contextClose.addEventListener('click', () => {
                const contextSection = document.querySelector('.context-section');
                if (contextSection) {
                    contextSection.style.display = 'none';
                    // Add any additional cleanup or state management here
                    vscode.postMessage({
                        command: 'clear_context',
                        value: null
                    });
                }
            });
        }
    });

    // Function to update context display
    function updateContext(filename) {
        const contextSection = document.querySelector('.context-section');
        const contextName = document.querySelector('.context-name');
        if (contextSection && contextName) {
            contextName.textContent = filename;
            contextSection.style.display = 'flex';
        }
    }

    function selectFileContext() {
        const dropup = document.getElementById('context-dropup');
        const searchInput = document.getElementById('file-search');
        const previewDropup = document.getElementById('code-preview-dropup');
        previewDropup.style.display = 'none';
        
        if (dropup.style.display === 'none') {
            dropup.style.display = 'block';
            searchInput.value = ''; // Clear search input
            searchInput.focus(); // Focus the search input
        } else {
            dropup.style.display = 'none';
        }
        
        // Request file list from VS Code
        vscode.postMessage({
            command: 'get_file_list'
        });
    }

    function selectFileContextWithId(id) {
        vscode.postMessage({
            command: 'log_event',
            value: `##ERROR Error in selectFileContextWithId Called ${id}`
        })
        try{
            const dropup = document.getElementById('context-dropup-'+id);
            const searchInput = document.getElementById('file-search-'+id);
            const previewDropup = document.getElementById('code-preview-dropup-'+id);
            previewDropup.style.display = 'none';
                
            if (dropup.style.display === 'none') {
                dropup.style.display = 'block';
                searchInput.value = ''; // Clear search input
                searchInput.focus(); // Focus the search input
            } else {
                dropup.style.display = 'none';
            }
        
            // Request file list from VS Code
            vscode.postMessage({
                command: 'get_file_list_with_id', 
                value: {
                        id: id
                    }
                });
        }catch(e){
            vscode.postMessage({
                command: 'log_event',
                value: `###ERROR Error in selectFileContextWithId ${e}`
            })
        }
    }

    var allUsersFiles = [];
    function updateFileList(files, addedFiles) {
        allUsersFiles = files;
        try{
            const availableContainer = document.getElementById('available-files');
            const addedContainer = document.getElementById('added-files');
            
            // Clear existing content
            availableContainer.innerHTML = '';
            addedContainer.innerHTML = '';
            
            // Add the files to their respective sections
            addedFiles.forEach(file => {
                const fileItem = createFileItem(file, true);
                addedContainer.appendChild(fileItem);
            });
            
            files.forEach(file => {
                if (!addedFiles.includes(file)) {
                    const fileItem = createFileItem(file, false);
                    availableContainer.appendChild(fileItem);
                }
            });
            return [addedFiles, files];
        }catch(e){
            vscode.postMessage({
                command: 'log_event',
                value: `###ERROR Error in updateFileList ${e}`
            })
        }
        
    }

    function updateFileListWithId(id, files, addedFiles) {
        vscode.postMessage({
                command: 'log_event',
                value: `##ERROR Error in updateFileListWithId CALLED ${id}`
            })
        try{
            const availableContainer = document.getElementById('available-files-'+id);
            const addedContainer = document.getElementById('added-files-'+id);
            
            // Clear existing content
            availableContainer.innerHTML = '';
            addedContainer.innerHTML = '';
            vscode.postMessage({
                    command: 'log_event',
                    value: `##ERROR Error in updateFileListWithId CALLED ${id} files ${files} addedFiles ${addedFiles} availableContainer ${availableContainer} addedContainer ${addedContainer}`
                })
            
            // Add the files to their respective sections
            addedFiles.forEach(file => {
                const fileItem = createFileItemWithId(file, true, id);
                addedContainer.appendChild(fileItem);
            });
            files.forEach(file => {
                if (!addedFiles.includes(file)) {
                    const fileItem = createFileItemWithId(file, false, id);
                    availableContainer.appendChild(fileItem);
                }
            });
            return [addedFiles, files];
        }catch(e){
            vscode.postMessage({
                command: 'log_event',
                value: `###ERROR Error in updateFileList ${e}`
            })
        }
        
    }

    function createFileItem(fileName, isAdded) {
        const div = document.createElement('div');
        div.className = 'file-item';
        if (isAdded) {
            div.classList.add('selected');
        }

        // Split the path into filename and directory
        const parts = fileName.split('/');
        const name = parts.pop() || '';
        const path = parts.join('/');
        
        div.innerHTML = `
            <div class="file-item-left">
                <div class="file-name">
                    ${getFileIcon(name)}
                    <span>${name}</span>
                </div>
            </div>
            ${path ? `<div class="file-path">/${path}</div>` : ''}
        `;
        
        div.onclick = () => {
            if (isAdded) {
                vscode.postMessage({
                    command: 'remove_file_context',
                    value: fileName
                });
            } else {
                vscode.postMessage({
                    command: 'add_file_context',
                    value: fileName
                });
            }
        };
        
        return div;
    }

    function createFileItemWithId(fileName, isAdded, id) {
        vscode.postMessage({
            command: 'log_event',
            value: `##ERROR Error in createFileItemWithId CALLED ${id} fileName ${fileName} isAdded ${isAdded}`
        })
        const div = document.createElement('div');
        div.className = 'file-item';
        if (isAdded) {
            div.classList.add('selected');
        }

        // Split the path into filename and directory
        const parts = fileName.split('/');
        const name = parts.pop() || '';
        const path = parts.join('/');
        
        div.innerHTML = `
            <div class="file-item-left">
                <div class="file-name">
                    ${getFileIcon(name)}
                    <span>${name}</span>
                </div>
            </div>
            ${path ? `<div class="file-path">/${path}</div>` : ''}
        `;
        
        div.onclick = () => {
            if (isAdded) {
                vscode.postMessage({
                    command: 'remove_file_context_with_id',
                    value: {
                        fileName: fileName,
                        id: id
                    }
                });
            } else {
                vscode.postMessage({
                    command: 'add_file_context_with_id',
                    value: {
                        fileName: fileName,
                        id: id
                    }
                });
            }
        };
        
        return div;
    }

  
    // Add to existing message handler
    window.addEventListener('message', event => {
        const message = event.data;
        switch (message.command) {
            case 'update_file_list':
                updateFileList(message.value.files, message.value.addedFiles);
                updateContextChips(message.value.addedFiles);
                break;

            case 'update_file_list_with_id':
                try{
                    vscode.postMessage({
                        command: 'log_event',
                        value: `##ERROR Error in selectFileContextWithId CALLED update_file_list_with_id ${message.value.id}`
                    })
                    allUsersFiles = message.value.files;
                    updateFileListWithId(message.value.id, message.value.files, message.value.addedFiles);
                    updateContextChipsWithId(message.value.id, message.value.files, message.value.addedFiles);
                }catch(e){
                    vscode.postMessage({
                        command: 'log_event',
                        value: `###ERROR Error in selectFileContextWithId update_file_list_with_id ${e}`
                    })
                }
                break;

            case 'show_file_preview':
                showCodePreview(
                    message.value.filePath, 
                    message.value.content,
                    message.value.isImage
                );
                break;

            case 'show_file_preview_with_id':
                showCodePreviewWithId(
                    message.value.id,
                    message.value.filePath, 
                    message.value.content,
                    message.value.isImage
                );
                vscode.postMessage({
                    command: 'log_event',
                    value: "###PREVIEWWWWWWWIDD Checking if show_file_preview_with_id called back 111"
                })
                break;
        }
    });

    // Add this new function to handle file filtering
    function filterFiles(searchTerm) {
        try {
            const availableContainer = document.getElementById('available-files');
            availableContainer.innerHTML = '';
            
            const addedFilesSet = new Set(allAddedFiles);
            
            // Filter files based on search term
            const filteredFiles = allUsersFiles.filter(file => {
                const fileName = file.toLowerCase();
                return fileName.includes(searchTerm.toLowerCase());
            });
            
            // Display filtered files
            filteredFiles.forEach(file => {
                if (!addedFilesSet.has(file)) {
                    const fileItem = createFileItem(file, false);
                    availableContainer.appendChild(fileItem);
                }
            });
        } catch(e) {
            vscode.postMessage({
                command: 'log_event',
                value: `###ERROR Error in filterFiles ${e}`
            });
        }
    }
    function filterFilesWithId(searchTerm, id) {
        try {
            const availableContainer = document.getElementById('available-files-'+id);
            availableContainer.innerHTML = '';
            
            const addedFilesSet = new Set(allAddedFiles);
            
            // Filter files based on search term
            const filteredFiles = allUsersFiles.filter(file => {
                const fileName = file.toLowerCase();
                return fileName.includes(searchTerm.toLowerCase());
            });
            
            // Display filtered files
            filteredFiles.forEach(file => {
                if (!addedFilesSet.has(file)) {
                    const fileItem = createFileItemWithId(file, false, id);
                    availableContainer.appendChild(fileItem);
                }
            });
        } catch(e) {
            vscode.postMessage({
                command: 'log_event',
                value: `###ERROR Error in filterFilesWithId ${e}`
            });
        }
    }

    function hideAllPreviews() {
        // Hide regular preview
        const regularPreview = document.getElementById('code-preview-dropup');
        if (regularPreview) {
            regularPreview.style.display = 'none';
        }
        
        // Hide all dynamic previews
        document.querySelectorAll('[id^="code-preview-dropup-"]').forEach(preview => {
            preview.style.display = 'none';
        });
    }

    function retryConnection(button) {
        // Find the closest connection error div and hide it
        const errorDiv = button.closest('.connection-error');
        if (errorDiv) {
            errorDiv.style.display = 'none';
        }
        
        // Find the closest bot response div and show the generating text
        const botDiv = button.closest('.bot.response');
        if (botDiv) {
            const generatingText = botDiv.querySelector('.generating-text');
            if (generatingText) {
                generatingText.style.display = 'block';
            }
        }

        // Get the last message from the user's input
        const lastUserDiv = button.closest('.dynamic-input-wrapper');
        if (lastUserDiv) {
            const textarea = lastUserDiv.querySelector('textarea');
            if (textarea) {
                const lastMessage = textarea.value;
                
                // Send retry command to VS Code
                vscode.postMessage({
                    command: 'retry_connection',
                    value: lastMessage
                });
            }
        }
    }
</script>

<script>
    var showCodeSpinner=false;
    var lastShowedCodeSpinner=0;
    var curMessageId= "";
// Function to check if code blocks need expand buttons
    function initializeCodeBlocks() {
        lastShowedCodeSpinner=Date.now();
        document.querySelectorAll('.code-block').forEach(block => {
            const content = block.querySelector('pre');
            const existingButton = block.querySelector('.expand-button');
            
            // Check if this block was previously expanded
            const wasExpanded = block.classList.contains('expanded');
            
            if (content.scrollHeight > 650 || wasExpanded) {
                block.classList.add('overflow');
                const spinner = block.querySelector(".spinner-container");
                showCodeSpinner=true;
                vscode.postMessage({
                    command: "log_event",
                    value: `Show code spinner ${showCodeSpinner} ${spinner.className} ${spinner.classList} ${curMessageId}`
                })

                spinner.classList.add("show");
                // Keep scroll at bottom if not expanded
                if (!wasExpanded) {
                    content.scrollTop = content.scrollHeight;
                }
                
                // Create expand button if it doesn't exist
                if (!existingButton) {
                    const expandBtn = document.createElement('div');
                    expandBtn.className = 'expand-button';
                    expandBtn.innerHTML = '<i class="fas fa-chevron-down"></i>';
                    expandBtn.onclick = (e) => {
                        e.stopPropagation(); // Prevent event bubbling
                        block.classList.toggle('expanded');
                        block.dataset.expanded = block.classList.contains('expanded');
                        
                        // Update button icon
                        const icon = expandBtn.querySelector('i');
                        if (block.classList.contains('expanded')) {
                            icon.className = 'fas fa-chevron-up';
                        } else {
                            icon.className = 'fas fa-chevron-down';
                            // Scroll to bottom when collapsing
                            content.scrollTop = content.scrollHeight;
                        }
                    };
                    block.appendChild(expandBtn);
                    //block.appendChild(spinner);
                }
            }
        });
    }

    // Modify the observer to handle content changes
    const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
            if (mutation.addedNodes.length) {
                initializeCodeBlocks();
                
                // Find expanded code blocks and ensure they stay expanded
                document.querySelectorAll('.code-block.expanded').forEach(block => {
                    const content = block.querySelector('pre');
                    if (content) {
                        content.style.maxHeight = 'none';
                        content.style.overflowY = 'visible';
                    }
                });
            }
        });
    });

    observer.observe(document.getElementById('messages'), {
        childList: true,
        subtree: true,
        characterData: true
    });
</script>

<script>
function switchTab(tabName) {
    // Remove active class from all tabs
    document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Add active class to clicked tab
    const activeTab = document.querySelector(`.tab[onclick="switchTab('${tabName}')"]`);
    if (activeTab) {
        activeTab.classList.add('active');
    }
    
    // Handle tab content switching
    vscode.postMessage({
        command: 'switch_tab',
        value: tabName
    });
}

function addNewTab() {
    vscode.postMessage({
        command: 'add_new_tab'
    });
}

function showHistory() {
    vscode.postMessage({
        command: 'show_history'
    });
}

function showMenu() {
    vscode.postMessage({
        command: 'show_menu'
    });
}

function closePanel() {
    vscode.postMessage({
        command: 'close_panel'
    });
}
</script>
<style>

.image-preview-container.svg-container {
    padding: 16px;
    background: var(--editor-background);
}

.image-preview-container.svg-container svg {
    max-width: 100%;
    max-height: 300px;
    width: auto;
    height: auto;
}

/* Update image preview styles */
.image-preview-container {
    display: flex;
    justify-content: center;
    align-items: center;
    background: var(--editor-background);
    padding: 16px;
    border-radius: 4px;
    height: 300px; /* Fixed height for consistency */
    overflow: hidden;
}

.image-preview-container img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain; /* Maintain aspect ratio while fitting */
    margin: 0;
}

/* SVG-specific styles */
.image-preview-container.svg-container {
    height: auto; /* Allow SVGs to determine their own height */
    padding: 16px;
    background: var(--editor-background);
}

.image-preview-container.svg-container svg {
    max-width: 100%;
    max-height: 300px;
    width: auto;
    height: auto;
}
</style>

<style>
    /* Add styles for the connection error message */
    .connection-error {
        display: none;
        padding: 8px 12px;
        background-color: rgba(255, 0, 0, 0.1);
        border-bottom: 1px solid var(--input-foreground);
        font-size: 11px;
        color: var(--editor-foreground);
        gap: 8px;
        align-items: center;
    }

    .connection-error button {
        background: transparent;
        border: none;
        color: var(--editor-foreground);
        font-size: 11px;
        cursor: pointer;
        padding: 2px 8px;
        opacity: 0.8;
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .connection-error button:hover {
        opacity: 1;
    }
</style>

<style>
    .error-context-chip {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 4px 8px;
        background: var(--editor-background);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 4px;
        font-size: 12px;
        cursor: pointer;
        margin-bottom: 8px;
    }

    .error-context-chip:hover {
        background: rgba(255, 255, 255, 0.1);
    }

    .error-context-chip .file-icon {
        width: 16px;
        height: 16px;
    }

    .error-context-chip .file-name {
        color: var(--editor-foreground);
    }
</style>

</html>